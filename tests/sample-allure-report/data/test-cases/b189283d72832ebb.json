{"uid":"b189283d72832ebb","name":"Given: an event type with a REJECTED subscription; When: message is published; Then: publish succeeds and event is created and no message is published","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests.Given: an event type with #subscriptionStatus; When: message is published; Then: publish succeeds and event is created and no message is published","historyId":"db17fae5a1af35a06185146299e89e11","time":{"start":1697105213289,"stop":1697105213627,"duration":338},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: an event type with no active subscriptions","time":{"start":1697105213475,"stop":1697105213475,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105213478,"stop":1697105213485,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-7826-7651-9f84-a1d2ea70fe75', '018b235a-77fb-7a31-bb92-0d879111116c', '018b235a-7802-769e-9281-6f8ef1014196', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-7769-7903-98d5-52faa6f398a1', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:53.478061100Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105213478,"stop":1697105213478,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-7826-7651-9f84-a1d2ea70fe75', '018b235a-77fb-7a31-bb92-0d879111116c', '018b235a-7802-769e-9281-6f8ef1014196', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-7769-7903-98d5-52faa6f398a1', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:53.478061100Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1f4c8062"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213485,"stop":1697105213491,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-782d-76ba-a45c-0a4b36d20a8f', '018b235a-7826-7651-9f84-a1d2ea70fe75', 'PENDING', now())","time":{"start":1697105213485,"stop":1697105213485,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-782d-76ba-a45c-0a4b36d20a8f', '018b235a-7826-7651-9f84-a1d2ea70fe75', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@25ae0223"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213493,"stop":1697105213501,"duration":8},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-7835-7890-8c1c-e527140be23a', '018b235a-7826-7651-9f84-a1d2ea70fe75', 'REJECTED', now())","time":{"start":1697105213493,"stop":1697105213493,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-7835-7890-8c1c-e527140be23a', '018b235a-7826-7651-9f84-a1d2ea70fe75', 'REJECTED', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@9a82ef"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213501,"stop":1697105213506,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:53.501829200Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB,\n    deleted_at = now()\nWHERE id = '018b235a-7826-7651-9f84-a1d2ea70fe75'","time":{"start":1697105213502,"stop":1697105213502,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:53.501829200Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB,\n    deleted_at = now()\nWHERE id = '018b235a-7826-7651-9f84-a1d2ea70fe75'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@666e1965"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: message is published","time":{"start":1697105213506,"stop":1697105213506,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-7769-7903-98d5-52faa6f398a1/room-018b235a-7769-7903-98d5-52faa6f398a1/publish","time":{"start":1697105213507,"stop":1697105213591,"duration":84},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-7769-7903-98d5-52faa6f398a1/room-018b235a-7769-7903-98d5-52faa6f398a1/publish","time":{"start":1697105213507,"stop":1697105213591,"duration":84},"status":"passed","steps":[],"attachments":[{"uid":"51828c7cf5564e9","name":"Request","source":"51828c7cf5564e9.html","type":"text/html","size":1160},{"uid":"d07528d8629ab522","name":"HTTP/1.1 200 OK","source":"d07528d8629ab522.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-7769-7903-98d5-52faa6f398a1"},{"name":"roomId","value":"room-018b235a-7769-7903-98d5-52faa6f398a1"},{"name":"message","value":"{eventType=EVENT-018b235a-7769-7903-98d5-52faa6f398a1, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-7769-7903-98d5-52faa6f398a1"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-7769-7903-98d5-52faa6f398a1"},{"name":"roomId","value":"room-018b235a-7769-7903-98d5-52faa6f398a1"},{"name":"message","value":"{eventType=EVENT-018b235a-7769-7903-98d5-52faa6f398a1, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"then: publish succeeds","time":{"start":1697105213591,"stop":1697105213591,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"and: event is created","time":{"start":1697105213591,"stop":1697105213591,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105213592,"stop":1697105213596,"duration":4},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105213592,"stop":1697105213595,"duration":3},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-77fb-7a31-bb92-0d879111116c'\n  AND event_type_version_id = '018b235a-7808-7252-bea5-5a09d3234dc0'\n  AND event_type_id = '018b235a-7802-769e-9281-6f8ef1014196'\n  AND publisher_id = '018b235a-7813-7c70-908d-abe11e23fe8a'","time":{"start":1697105213592,"stop":1697105213592,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-77fb-7a31-bb92-0d879111116c'\n  AND event_type_version_id = '018b235a-7808-7252-bea5-5a09d3234dc0'\n  AND event_type_id = '018b235a-7802-769e-9281-6f8ef1014196'\n  AND publisher_id = '018b235a-7813-7c70-908d-abe11e23fe8a'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@328f4e46"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(1):","time":{"start":1697105213596,"stop":1697105213596,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"[id:018b235a-7881-77a1-a208-aa35039fee27, room_id:018b235a-77fb-7a31-bb92-0d879111116c, event_type_version_id:018b235a-7808-7252-bea5-5a09d3234dc0, event_type_id:018b235a-7802-769e-9281-6f8ef1014196, publisher_id:018b235a-7813-7c70-908d-abe11e23fe8a, correlation_id:018b235a-7880-726d-9667-3a9ad69bdaf2, created_at:2023-10-12 13:06:53.569213]","time":{"start":1697105213596,"stop":1697105213596,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-77fb-7a31-bb92-0d879111116c'\n  AND event_type_version_id = '018b235a-7808-7252-bea5-5a09d3234dc0'\n  AND event_type_id = '018b235a-7802-769e-9281-6f8ef1014196'\n  AND publisher_id = '018b235a-7813-7c70-908d-abe11e23fe8a'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":4},{"name":"and: no message is published","time":{"start":1697105213622,"stop":1697105213622,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105213623,"stop":1697105213627,"duration":4},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105213623,"stop":1697105213627,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7881-77a1-a208-aa35039fee27'\n  AND published_at IS NOT NULL","time":{"start":1697105213623,"stop":1697105213623,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7881-77a1-a208-aa35039fee27'\n  AND published_at IS NOT NULL"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3861f2c9"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(0):","time":{"start":1697105213627,"stop":1697105213627,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7881-77a1-a208-aa35039fee27'\n  AND published_at IS NOT NULL"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":3},{"name":"where","time":{"start":1697105213627,"stop":1697105213627,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":25},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests"},{"name":"testMethod","value":"Given: an event type with a REJECTED subscription; When: message is published; Then: publish succeeds and event is created and no message is published"},{"name":"suite","value":"PublishTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.1 - Successful publish"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"POST /rooms/{memberId}/{roomId}/publish"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"subscriptionStatus","value":"a REJECTED subscription"}],"links":[{"name":"UC6.1","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"b189283d72832ebb.json","parameterValues":["a REJECTED subscription"]}