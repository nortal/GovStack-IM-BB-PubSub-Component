{"uid":"fc57ad070cead734","name":"Given: event type with 1 active PULL subscription; When: message is pulled with problem 'non-existent subscription'; Then: pull fails with 404","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PullTests.Given: event type with 1 active PULL subscription; When: message is pulled with problem '#problem'; Then: pull fails with #statusCode","historyId":"35768fe2359916168844309d12a52fc","time":{"start":1697105224397,"stop":1697105224644,"duration":247},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: event type with 1 active PULL subscription","time":{"start":1697105224465,"stop":1697105224465,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105224465,"stop":1697105224470,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-a311-7737-af99-bf9a908637df', '018b235a-a2ee-74e4-9932-405dae6dcef8', '018b235a-a2f4-7954-942f-0d1dd7006c84', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a2ce-7f6f-b160-450658854b45', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:04.465215200Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105224465,"stop":1697105224465,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-a311-7737-af99-bf9a908637df', '018b235a-a2ee-74e4-9932-405dae6dcef8', '018b235a-a2f4-7954-942f-0d1dd7006c84', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a2ce-7f6f-b160-450658854b45', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:04.465215200Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4906fbd0"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105224470,"stop":1697105224475,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a316-7f2f-9f4b-46bda29a98ba', '018b235a-a311-7737-af99-bf9a908637df', 'PENDING', now())","time":{"start":1697105224470,"stop":1697105224470,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a316-7f2f-9f4b-46bda29a98ba', '018b235a-a311-7737-af99-bf9a908637df', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6061d185"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105224476,"stop":1697105224481,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a31c-7168-afee-cce4dd068ed9', '018b235a-a311-7737-af99-bf9a908637df', 'ACTIVE', now())","time":{"start":1697105224476,"stop":1697105224476,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a31c-7168-afee-cce4dd068ed9', '018b235a-a311-7737-af99-bf9a908637df', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@16c5e7ad"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105224481,"stop":1697105224487,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:04.481703200Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-a311-7737-af99-bf9a908637df'","time":{"start":1697105224481,"stop":1697105224481,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:04.481703200Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-a311-7737-af99-bf9a908637df'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@160a3238"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-a2ce-7f6f-b160-450658854b45/room-018b235a-a2ce-7f6f-b160-450658854b45/publish","time":{"start":1697105224488,"stop":1697105224590,"duration":102},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-a2ce-7f6f-b160-450658854b45/room-018b235a-a2ce-7f6f-b160-450658854b45/publish","time":{"start":1697105224488,"stop":1697105224590,"duration":102},"status":"passed","steps":[],"attachments":[{"uid":"ddbbf45cacdaa43","name":"Request","source":"ddbbf45cacdaa43.html","type":"text/html","size":1160},{"uid":"8e913fdae92045e4","name":"HTTP/1.1 200 OK","source":"8e913fdae92045e4.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-a2ce-7f6f-b160-450658854b45"},{"name":"roomId","value":"room-018b235a-a2ce-7f6f-b160-450658854b45"},{"name":"message","value":"{eventType=EVENT-018b235a-a2ce-7f6f-b160-450658854b45, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-a2ce-7f6f-b160-450658854b45"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-a2ce-7f6f-b160-450658854b45"},{"name":"roomId","value":"room-018b235a-a2ce-7f6f-b160-450658854b45"},{"name":"message","value":"{eventType=EVENT-018b235a-a2ce-7f6f-b160-450658854b45, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"when: message is pulled with a problem","time":{"start":1697105224591,"stop":1697105224591,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"GET /rooms/non-existent/room-018b235a-a2ce-7f6f-b160-450658854b45/pull","time":{"start":1697105224594,"stop":1697105224622,"duration":28},"status":"passed","steps":[],"attachments":[{"uid":"dcd97f0dac70bc9","name":"Request","source":"dcd97f0dac70bc9.html","type":"text/html","size":623},{"uid":"87beb3b59f1b2e21","name":"HTTP/1.1 404 Not Found","source":"87beb3b59f1b2e21.html","type":"text/html","size":359}],"parameters":[{"name":"memberId","value":"non-existent"},{"name":"roomId","value":"room-018b235a-a2ce-7f6f-b160-450658854b45"},{"name":"subscriptionId","value":"018b235a-a311-7737-af99-bf9a908637df"},{"name":"header","value":"X-Road-Client=non-existent"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: pull fails","time":{"start":1697105224622,"stop":1697105224622,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105224644,"stop":1697105224644,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"stepsCount":15},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PullTests"},{"name":"testMethod","value":"Given: event type with 1 active PULL subscription; When: message is pulled with problem 'non-existent subscription'; Then: pull fails with 404"},{"name":"suite","value":"PullTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.3 - Unsuccessful pull"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"GET /rooms/{memberId}/{roomId}/pull"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Subscription was not found"},{"name":"problem","value":"non-existent subscription"},{"name":"statusCode","value":"404"}],"links":[{"name":"UC6.3","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"fc57ad070cead734.json","parameterValues":["Subscription was not found","non-existent subscription","404"]}