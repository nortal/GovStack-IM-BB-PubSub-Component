{"uid":"266017e11fe48097","name":"Given: an event type; When: a message with problem 'request data matching previous json schema version' is published; Then: publish fails with 400: 'The event payload is not compatible with the event type' ","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests.Given: an event type; When: a message with problem '#problem' is published; Then: publish fails with #errorCode: '#errorMessage' ","historyId":"158a24e0b62387f47b0bd89507716fd","time":{"start":1697105221670,"stop":1697105221858,"duration":188},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: an event type","time":{"start":1697105221742,"stop":1697105221742,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"when: message with a problem is published","time":{"start":1697105221742,"stop":1697105221742,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105221745,"stop":1697105221750,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-9871-7588-94ee-36d8bf07a620', '018b235a-9852-746e-94c0-f1c3df9ad202', 2, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload2\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload2\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:07:01.745642400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105221745,"stop":1697105221745,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-9871-7588-94ee-36d8bf07a620', '018b235a-9852-746e-94c0-f1c3df9ad202', 2, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload2\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload2\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:07:01.745642400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@106dbf5f"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-9827-7265-b520-2c0c68003281/room-018b235a-9827-7265-b520-2c0c68003281/publish","time":{"start":1697105221751,"stop":1697105221805,"duration":54},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-9827-7265-b520-2c0c68003281/room-018b235a-9827-7265-b520-2c0c68003281/publish","time":{"start":1697105221751,"stop":1697105221805,"duration":54},"status":"passed","steps":[],"attachments":[{"uid":"e99e173708a3dc5d","name":"Request","source":"e99e173708a3dc5d.html","type":"text/html","size":1160},{"uid":"381f2b8bb87be0c0","name":"HTTP/1.1 400 Bad Request","source":"381f2b8bb87be0c0.html","type":"text/html","size":389}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-9827-7265-b520-2c0c68003281"},{"name":"roomId","value":"room-018b235a-9827-7265-b520-2c0c68003281"},{"name":"message","value":"{eventType=EVENT-018b235a-9827-7265-b520-2c0c68003281, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-9827-7265-b520-2c0c68003281"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-9827-7265-b520-2c0c68003281"},{"name":"roomId","value":"room-018b235a-9827-7265-b520-2c0c68003281"},{"name":"message","value":"{eventType=EVENT-018b235a-9827-7265-b520-2c0c68003281, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"then: publish fails","time":{"start":1697105221805,"stop":1697105221805,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"and: no events created","time":{"start":1697105221854,"stop":1697105221854,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105221854,"stop":1697105221858,"duration":4},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105221854,"stop":1697105221857,"duration":3},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-984c-7bca-b38b-1f72fccd4b00'\n  AND event_type_version_id = '018b235a-9871-7588-94ee-36d8bf07a620'\n  AND event_type_id = '018b235a-9852-746e-94c0-f1c3df9ad202'\n  AND publisher_id = '018b235a-985e-7556-9181-4cdf3633ff71'","time":{"start":1697105221854,"stop":1697105221854,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-984c-7bca-b38b-1f72fccd4b00'\n  AND event_type_version_id = '018b235a-9871-7588-94ee-36d8bf07a620'\n  AND event_type_id = '018b235a-9852-746e-94c0-f1c3df9ad202'\n  AND publisher_id = '018b235a-985e-7556-9181-4cdf3633ff71'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@912e308"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(0):","time":{"start":1697105221857,"stop":1697105221857,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-984c-7bca-b38b-1f72fccd4b00'\n  AND event_type_version_id = '018b235a-9871-7588-94ee-36d8bf07a620'\n  AND event_type_id = '018b235a-9852-746e-94c0-f1c3df9ad202'\n  AND publisher_id = '018b235a-985e-7556-9181-4cdf3633ff71'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":3},{"name":"where","time":{"start":1697105221858,"stop":1697105221858,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":13},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests"},{"name":"testMethod","value":"Given: an event type; When: a message with problem 'request data matching previous json schema version' is published; Then: publish fails with 400: 'The event payload is not compatible with the event type' "},{"name":"suite","value":"PublishTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.1 - Unsuccessful publish"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"POST /rooms/{memberId}/{roomId}/publish"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"errorCode","value":"400"},{"name":"errorMessage","value":"The event payload is not compatible with the event type"},{"name":"problem","value":"request data matching previous json schema version"}],"links":[{"name":"UC6.1","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"266017e11fe48097.json","parameterValues":["400","The event payload is not compatible with the event type","request data matching previous json schema version"]}