{"uid":"46bf8a462e197181","name":"Given: a member with a subscription in a room; When: member lists their subscriptions with a problem ''X-Road-Client' header not matching 'memberId''; Then: listing of subscription fails with 403","fullName":"com.govstack.information_mediator.pubsub.api.management.subscriptions.ListSubscriptionsTests.Given: a member with a subscription in a room; When: member lists their subscriptions with a problem '#problem'; Then: listing of subscription fails with #statusCode","historyId":"4a703dd48398564f05e794a9977d4c64","time":{"start":1697105203655,"stop":1697105203855,"duration":200},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup","time":{"start":1697105203655,"stop":1697105203716,"duration":61},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105203690,"stop":1697105203696,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-51c7-7467-a070-9ccc60d47ca7', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-51c7-7cb1-bac4-74ed6ed04e0a', now(), NULL)","time":{"start":1697105203691,"stop":1697105203691,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-51c7-7467-a070-9ccc60d47ca7', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-51c7-7cb1-bac4-74ed6ed04e0a', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@68cacf8b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105203697,"stop":1697105203702,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-51f1-7f84-83ec-5562c43985d0', '018b235a-51c7-7467-a070-9ccc60d47ca7', 'room-018b235a-51c7-7cb1-bac4-74ed6ed04e0a', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:43.697088800Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105203697,"stop":1697105203697,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-51f1-7f84-83ec-5562c43985d0', '018b235a-51c7-7467-a070-9ccc60d47ca7', 'room-018b235a-51c7-7cb1-bac4-74ed6ed04e0a', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:43.697088800Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@7b8247bc"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105203702,"stop":1697105203707,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-51f6-7ad1-b4de-16e5d0ad14ab', '018b235a-51f1-7f84-83ec-5562c43985d0', 'EVENT-018b235a-51c7-7cb1-bac4-74ed6ed04e0a', '[{\"at\": \"2023-10-12T10:06:43.702836700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105203702,"stop":1697105203702,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-51f6-7ad1-b4de-16e5d0ad14ab', '018b235a-51f1-7f84-83ec-5562c43985d0', 'EVENT-018b235a-51c7-7cb1-bac4-74ed6ed04e0a', '[{\"at\": \"2023-10-12T10:06:43.702836700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3743d16b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105203707,"stop":1697105203716,"duration":9},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-51fb-717a-8e46-f6c760663e91', '018b235a-51f6-7ad1-b4de-16e5d0ad14ab', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:43.707947600Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105203707,"stop":1697105203707,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-51fb-717a-8e46-f6c760663e91', '018b235a-51f6-7ad1-b4de-16e5d0ad14ab', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:43.707947600Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@b772e2b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":8}],"testStage":{"status":"passed","steps":[{"name":"given: a member with a subscriptions status in a room;","time":{"start":1697105203717,"stop":1697105203717,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105203718,"stop":1697105203723,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-5205-71ef-b02c-883e0aecdcc5', '018b235a-51f1-7f84-83ec-5562c43985d0', '018b235a-51f6-7ad1-b4de-16e5d0ad14ab', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-51c7-7cb1-bac4-74ed6ed04e0a', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:43.718411400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105203718,"stop":1697105203718,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-5205-71ef-b02c-883e0aecdcc5', '018b235a-51f1-7f84-83ec-5562c43985d0', '018b235a-51f6-7ad1-b4de-16e5d0ad14ab', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-51c7-7cb1-bac4-74ed6ed04e0a', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:43.718411400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@357f1e59"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105203723,"stop":1697105203728,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-520b-7316-b848-f6f26e5d0377', '018b235a-5205-71ef-b02c-883e0aecdcc5', 'PENDING', now())","time":{"start":1697105203723,"stop":1697105203723,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-520b-7316-b848-f6f26e5d0377', '018b235a-5205-71ef-b02c-883e0aecdcc5', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@5c2900ed"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: member lists their subscriptions with a problem","time":{"start":1697105203728,"stop":1697105203728,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"GET /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-51c7-7cb1-bac4-74ed6ed04e0a/room-018b235a-51c7-7cb1-bac4-74ed6ed04e0a/subscriptions","time":{"start":1697105203729,"stop":1697105203773,"duration":44},"status":"passed","steps":[],"attachments":[{"uid":"8e71b4ca948075a3","name":"Request","source":"8e71b4ca948075a3.html","type":"text/html","size":653},{"uid":"1614b4c983c334fa","name":"HTTP/1.1 403 ","source":"1614b4c983c334fa.html","type":"text/html","size":1021}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-51c7-7cb1-bac4-74ed6ed04e0a"},{"name":"roomId","value":"room-018b235a-51c7-7cb1-bac4-74ed6ed04e0a"},{"name":"status","value":"null"},{"name":"header","value":"X-Road-Client=non-existent"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: listing of subscription fails","time":{"start":1697105203773,"stop":1697105203773,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105203855,"stop":1697105203855,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":9},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions.ListSubscriptionsTests"},{"name":"testMethod","value":"Given: a member with a subscription in a room; When: member lists their subscriptions with a problem ''X-Road-Client' header not matching 'memberId''; Then: listing of subscription fails with 403"},{"name":"suite","value":"ListSubscriptionsTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"Unsuccessful subscriptions listing"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"GET /rooms/{memberId}/{roomId}/subscriptions"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Forbidden"},{"name":"problem","value":"'X-Road-Client' header not matching 'memberId'"},{"name":"statusCode","value":"403"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"46bf8a462e197181.json","parameterValues":["Forbidden","'X-Road-Client' header not matching 'memberId'","403"]}