{"uid":"cc8ccee041f524ed","name":"Given: event type with 1 active PULL subscription and a published message; When: message is pulled; Then: pull succeeds and no more events in queue and message marked as delivered","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PullTests.Given: event type with 1 active PULL subscription and a published message; When: message is pulled; Then: pull succeeds and no more events in queue and message marked as delivered","historyId":"b7b49eca23fae8e2a3c364fe1148ad2d","time":{"start":1697105222923,"stop":1697105223443,"duration":520},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: event type with 1 active PULL subscription and a published message","time":{"start":1697105223008,"stop":1697105223008,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105223008,"stop":1697105223015,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-9d60-7f3e-af4a-08e035f10a20', '018b235a-9d39-7218-8ac1-8f02cb2253f1', '018b235a-9d42-76b6-880b-65ef73f935ad', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-9d0c-779f-868b-2eeea036dc10', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:03.008694700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105223008,"stop":1697105223008,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-9d60-7f3e-af4a-08e035f10a20', '018b235a-9d39-7218-8ac1-8f02cb2253f1', '018b235a-9d42-76b6-880b-65ef73f935ad', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-9d0c-779f-868b-2eeea036dc10', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:03.008694700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@21e896f6"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105223015,"stop":1697105223021,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-9d67-7d75-ac01-8609da8ff86d', '018b235a-9d60-7f3e-af4a-08e035f10a20', 'PENDING', now())","time":{"start":1697105223015,"stop":1697105223015,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-9d67-7d75-ac01-8609da8ff86d', '018b235a-9d60-7f3e-af4a-08e035f10a20', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4f0e4307"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105223022,"stop":1697105223027,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-9d6e-7757-a3a3-4d0765216f77', '018b235a-9d60-7f3e-af4a-08e035f10a20', 'ACTIVE', now())","time":{"start":1697105223022,"stop":1697105223022,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-9d6e-7757-a3a3-4d0765216f77', '018b235a-9d60-7f3e-af4a-08e035f10a20', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6e64e5f5"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105223028,"stop":1697105223034,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:03.028872500Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-9d60-7f3e-af4a-08e035f10a20'","time":{"start":1697105223028,"stop":1697105223028,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:03.028872500Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-9d60-7f3e-af4a-08e035f10a20'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@34fb5c3f"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-9d0c-779f-868b-2eeea036dc10/room-018b235a-9d0c-779f-868b-2eeea036dc10/publish","time":{"start":1697105223035,"stop":1697105223183,"duration":148},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-9d0c-779f-868b-2eeea036dc10/room-018b235a-9d0c-779f-868b-2eeea036dc10/publish","time":{"start":1697105223035,"stop":1697105223183,"duration":148},"status":"passed","steps":[],"attachments":[{"uid":"a95a8484d43d966e","name":"Request","source":"a95a8484d43d966e.html","type":"text/html","size":1160},{"uid":"587c80b1d4b02c99","name":"HTTP/1.1 200 OK","source":"587c80b1d4b02c99.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-9d0c-779f-868b-2eeea036dc10"},{"name":"roomId","value":"room-018b235a-9d0c-779f-868b-2eeea036dc10"},{"name":"message","value":"{eventType=EVENT-018b235a-9d0c-779f-868b-2eeea036dc10, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-9d0c-779f-868b-2eeea036dc10"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-9d0c-779f-868b-2eeea036dc10"},{"name":"roomId","value":"room-018b235a-9d0c-779f-868b-2eeea036dc10"},{"name":"message","value":"{eventType=EVENT-018b235a-9d0c-779f-868b-2eeea036dc10, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"when: message is pulled","time":{"start":1697105223184,"stop":1697105223184,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"GET /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-9d0c-779f-868b-2eeea036dc10/room-018b235a-9d0c-779f-868b-2eeea036dc10/pull","time":{"start":1697105223185,"stop":1697105223409,"duration":224},"status":"passed","steps":[{"name":"GET /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-9d0c-779f-868b-2eeea036dc10/room-018b235a-9d0c-779f-868b-2eeea036dc10/pull","time":{"start":1697105223185,"stop":1697105223409,"duration":224},"status":"passed","steps":[],"attachments":[{"uid":"81e9fcade83677f2","name":"Request","source":"81e9fcade83677f2.html","type":"text/html","size":843},{"uid":"26db3a988cf87669","name":"HTTP/1.1 200 OK","source":"26db3a988cf87669.html","type":"text/html","size":332}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-9d0c-779f-868b-2eeea036dc10"},{"name":"roomId","value":"room-018b235a-9d0c-779f-868b-2eeea036dc10"},{"name":"subscriptionId","value":"018b235a-9d60-7f3e-af4a-08e035f10a20"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-9d0c-779f-868b-2eeea036dc10"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-9d0c-779f-868b-2eeea036dc10"},{"name":"roomId","value":"room-018b235a-9d0c-779f-868b-2eeea036dc10"},{"name":"subscriptionId","value":"018b235a-9d60-7f3e-af4a-08e035f10a20"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"then: pull succeeds and no more events in queue","time":{"start":1697105223409,"stop":1697105223409,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"and: message marked as delivered","time":{"start":1697105223428,"stop":1697105223428,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105223428,"stop":1697105223437,"duration":9},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105223429,"stop":1697105223437,"duration":8},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-9d39-7218-8ac1-8f02cb2253f1'\n  AND event_type_version_id = '018b235a-9d49-7c09-82e4-fea1a97a2a58'\n  AND event_type_id = '018b235a-9d42-76b6-880b-65ef73f935ad'\n  AND publisher_id = '018b235a-9d51-748e-b2b6-e11705b0d857'","time":{"start":1697105223429,"stop":1697105223429,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-9d39-7218-8ac1-8f02cb2253f1'\n  AND event_type_version_id = '018b235a-9d49-7c09-82e4-fea1a97a2a58'\n  AND event_type_id = '018b235a-9d42-76b6-880b-65ef73f935ad'\n  AND publisher_id = '018b235a-9d51-748e-b2b6-e11705b0d857'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@597d1122"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(1):","time":{"start":1697105223437,"stop":1697105223437,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"[id:018b235a-9dae-7524-b9cc-8930bf412b24, room_id:018b235a-9d39-7218-8ac1-8f02cb2253f1, event_type_version_id:018b235a-9d49-7c09-82e4-fea1a97a2a58, event_type_id:018b235a-9d42-76b6-880b-65ef73f935ad, publisher_id:018b235a-9d51-748e-b2b6-e11705b0d857, correlation_id:018b235a-9dad-70fd-a5f3-7b848ff98f6c, created_at:2023-10-12 13:07:03.085878]","time":{"start":1697105223437,"stop":1697105223437,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-9d39-7218-8ac1-8f02cb2253f1'\n  AND event_type_version_id = '018b235a-9d49-7c09-82e4-fea1a97a2a58'\n  AND event_type_id = '018b235a-9d42-76b6-880b-65ef73f935ad'\n  AND publisher_id = '018b235a-9d51-748e-b2b6-e11705b0d857'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":4},{"name":"DB results","time":{"start":1697105223438,"stop":1697105223442,"duration":4},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105223438,"stop":1697105223442,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM published_messages\nWHERE subscription_id = '018b235a-9d60-7f3e-af4a-08e035f10a20'\n  AND delivered_at IS NOT NULL  AND event_id = '018b235a-9dae-7524-b9cc-8930bf412b24'","time":{"start":1697105223438,"stop":1697105223438,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE subscription_id = '018b235a-9d60-7f3e-af4a-08e035f10a20'\n  AND delivered_at IS NOT NULL  AND event_id = '018b235a-9dae-7524-b9cc-8930bf412b24'\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6cfc536a"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(1):","time":{"start":1697105223442,"stop":1697105223442,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"[id:018b235a-9edf-7d2b-9541-ef4b8cfaf97c, event_id:018b235a-9dae-7524-b9cc-8930bf412b24, subscription_id:018b235a-9d60-7f3e-af4a-08e035f10a20, published_at:null, delivered_at:2023-10-12 13:07:03.390988]","time":{"start":1697105223442,"stop":1697105223442,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE subscription_id = '018b235a-9d60-7f3e-af4a-08e035f10a20'\n  AND delivered_at IS NOT NULL  AND event_id = '018b235a-9dae-7524-b9cc-8930bf412b24'\n"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":4}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"stepsCount":26},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PullTests"},{"name":"testMethod","value":"Given: event type with 1 active PULL subscription and a published message; When: message is pulled; Then: pull succeeds and no more events in queue and message marked as delivered"},{"name":"suite","value":"PullTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.3 - Successful pull"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"GET /rooms/{memberId}/{roomId}/pull"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[{"name":"UC6.3","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"cc8ccee041f524ed.json","parameterValues":[]}