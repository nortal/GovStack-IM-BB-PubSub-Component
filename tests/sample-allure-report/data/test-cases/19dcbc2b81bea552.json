{"uid":"19dcbc2b81bea552","name":"Given: event type with 1 active PULL subscription; When: message is pulled with problem 'TERMINATED subscription status'; Then: pull fails with 404","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PullTests.Given: event type with 1 active PULL subscription; When: message is pulled with problem '#problem'; Then: pull fails with #statusCode","historyId":"4addb01f9282571aba5a628eb739eb06","time":{"start":1697105224650,"stop":1697105224884,"duration":234},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: event type with 1 active PULL subscription","time":{"start":1697105224711,"stop":1697105224711,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105224712,"stop":1697105224717,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-a407-7478-8720-044caf656874', '018b235a-a3eb-7198-b151-e7fc945609f8', '018b235a-a3f0-7bb6-8787-b8ab4c822730', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:04.712358500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105224712,"stop":1697105224712,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-a407-7478-8720-044caf656874', '018b235a-a3eb-7198-b151-e7fc945609f8', '018b235a-a3f0-7bb6-8787-b8ab4c822730', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:04.712358500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@5451d7a0"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105224717,"stop":1697105224722,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a40d-73f0-b76b-4ec14a5b0ff4', '018b235a-a407-7478-8720-044caf656874', 'PENDING', now())","time":{"start":1697105224718,"stop":1697105224718,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a40d-73f0-b76b-4ec14a5b0ff4', '018b235a-a407-7478-8720-044caf656874', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1ccacb0c"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105224722,"stop":1697105224726,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a412-7cf6-a120-2602e67ba5e2', '018b235a-a407-7478-8720-044caf656874', 'ACTIVE', now())","time":{"start":1697105224722,"stop":1697105224722,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a412-7cf6-a120-2602e67ba5e2', '018b235a-a407-7478-8720-044caf656874', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@729c251b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105224726,"stop":1697105224730,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:04.726852800Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-a407-7478-8720-044caf656874'","time":{"start":1697105224726,"stop":1697105224726,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:04.726852800Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-a407-7478-8720-044caf656874'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@763a602"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9/room-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9/publish","time":{"start":1697105224731,"stop":1697105224826,"duration":95},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9/room-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9/publish","time":{"start":1697105224731,"stop":1697105224826,"duration":95},"status":"passed","steps":[],"attachments":[{"uid":"78221b12d4d346e8","name":"Request","source":"78221b12d4d346e8.html","type":"text/html","size":1160},{"uid":"ebfbd83ccead4e6","name":"HTTP/1.1 200 OK","source":"ebfbd83ccead4e6.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9"},{"name":"roomId","value":"room-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9"},{"name":"message","value":"{eventType=EVENT-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9"},{"name":"roomId","value":"room-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9"},{"name":"message","value":"{eventType=EVENT-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"when: message is pulled with a problem","time":{"start":1697105224826,"stop":1697105224826,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105224827,"stop":1697105224831,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a47b-737e-acc0-afa36b0230cc', '018b235a-a407-7478-8720-044caf656874', 'TERMINATED', now())","time":{"start":1697105224827,"stop":1697105224827,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a47b-737e-acc0-afa36b0230cc', '018b235a-a407-7478-8720-044caf656874', 'TERMINATED', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@59f0cf66"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105224831,"stop":1697105224836,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:04.831867800Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB,\n    deleted_at = now()\nWHERE id = '018b235a-a407-7478-8720-044caf656874'","time":{"start":1697105224831,"stop":1697105224831,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:04.831867800Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB,\n    deleted_at = now()\nWHERE id = '018b235a-a407-7478-8720-044caf656874'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@12f40682"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"GET /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9/room-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9/pull","time":{"start":1697105224836,"stop":1697105224866,"duration":30},"status":"passed","steps":[],"attachments":[{"uid":"5e6a326be78fd27a","name":"Request","source":"5e6a326be78fd27a.html","type":"text/html","size":843},{"uid":"805962ac1e4e3f8c","name":"HTTP/1.1 404 Not Found","source":"805962ac1e4e3f8c.html","type":"text/html","size":359}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9"},{"name":"roomId","value":"room-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9"},{"name":"subscriptionId","value":"018b235a-a407-7478-8720-044caf656874"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a3ca-7280-a8e3-4d1daf1ce8c9"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: pull fails","time":{"start":1697105224866,"stop":1697105224866,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105224884,"stop":1697105224884,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"stepsCount":19},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PullTests"},{"name":"testMethod","value":"Given: event type with 1 active PULL subscription; When: message is pulled with problem 'TERMINATED subscription status'; Then: pull fails with 404"},{"name":"suite","value":"PullTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.3 - Unsuccessful pull"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"GET /rooms/{memberId}/{roomId}/pull"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Subscription was not found"},{"name":"problem","value":"TERMINATED subscription status"},{"name":"statusCode","value":"404"}],"links":[{"name":"UC6.3","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"19dcbc2b81bea552.json","parameterValues":["Subscription was not found","TERMINATED subscription status","404"]}