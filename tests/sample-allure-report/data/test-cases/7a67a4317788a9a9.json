{"uid":"7a67a4317788a9a9","name":"Given: event type with 1 active PULL subscription; When: message is pulled with problem ''X-Road-Client' header not matching 'memberId''; Then: pull fails with 500","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PullTests.Given: event type with 1 active PULL subscription; When: message is pulled with problem '#problem'; Then: pull fails with #statusCode","historyId":"a3f2553736bfc770f82c24b84b38b9cd","time":{"start":1697105226670,"stop":1697105226903,"duration":233},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup","time":{"start":1697105226670,"stop":1697105226737,"duration":67},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105226700,"stop":1697105226706,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-abae-76a9-b81d-82b3b985c246', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-abae-747b-a482-ffa917bd1b8e', now(), NULL)","time":{"start":1697105226700,"stop":1697105226700,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-abae-76a9-b81d-82b3b985c246', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-abae-747b-a482-ffa917bd1b8e', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@26ec9c1b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226706,"stop":1697105226712,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-abd2-78f6-86a2-227c12283cb4', '018b235a-abae-76a9-b81d-82b3b985c246', 'room-018b235a-abae-747b-a482-ffa917bd1b8e', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:07:06.706568Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105226706,"stop":1697105226706,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-abd2-78f6-86a2-227c12283cb4', '018b235a-abae-76a9-b81d-82b3b985c246', 'room-018b235a-abae-747b-a482-ffa917bd1b8e', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:07:06.706568Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2494847f"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226712,"stop":1697105226718,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-abd8-7b39-b79d-b2ec50e1a088', '018b235a-abd2-78f6-86a2-227c12283cb4', 'EVENT-018b235a-abae-747b-a482-ffa917bd1b8e', '[{\"at\": \"2023-10-12T10:07:06.712822700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105226712,"stop":1697105226712,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-abd8-7b39-b79d-b2ec50e1a088', '018b235a-abd2-78f6-86a2-227c12283cb4', 'EVENT-018b235a-abae-747b-a482-ffa917bd1b8e', '[{\"at\": \"2023-10-12T10:07:06.712822700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6aae82b1"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226718,"stop":1697105226724,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-abde-7a4b-82c6-ce7be728b0f7', '018b235a-abd8-7b39-b79d-b2ec50e1a088', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:07:06.718088700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105226718,"stop":1697105226718,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-abde-7a4b-82c6-ce7be728b0f7', '018b235a-abd8-7b39-b79d-b2ec50e1a088', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:07:06.718088700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@43b5a9fd"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226725,"stop":1697105226731,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-abe4-7207-981a-42b0105ad4e7', '018b235a-abd2-78f6-86a2-227c12283cb4', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-abae-747b-a482-ffa917bd1b8e', '[{\"at\": \"2023-10-12T10:07:06.724865400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105226725,"stop":1697105226725,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-abe4-7207-981a-42b0105ad4e7', '018b235a-abd2-78f6-86a2-227c12283cb4', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-abae-747b-a482-ffa917bd1b8e', '[{\"at\": \"2023-10-12T10:07:06.724865400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1fbe9d4"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226731,"stop":1697105226737,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-abeb-732c-a135-469f47196b3d', '018b235a-abe4-7207-981a-42b0105ad4e7', '018b235a-abd8-7b39-b79d-b2ec50e1a088', now(), NULL)","time":{"start":1697105226731,"stop":1697105226731,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-abeb-732c-a135-469f47196b3d', '018b235a-abe4-7207-981a-42b0105ad4e7', '018b235a-abd8-7b39-b79d-b2ec50e1a088', now(), NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@14c22e8"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":12}],"testStage":{"status":"passed","steps":[{"name":"given: event type with 1 active PULL subscription","time":{"start":1697105226739,"stop":1697105226739,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105226739,"stop":1697105226745,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-abf3-70c8-a32c-72ca2b72bb76', '018b235a-abd2-78f6-86a2-227c12283cb4', '018b235a-abd8-7b39-b79d-b2ec50e1a088', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-abae-747b-a482-ffa917bd1b8e', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:06.739429600Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105226739,"stop":1697105226739,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-abf3-70c8-a32c-72ca2b72bb76', '018b235a-abd2-78f6-86a2-227c12283cb4', '018b235a-abd8-7b39-b79d-b2ec50e1a088', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-abae-747b-a482-ffa917bd1b8e', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:06.739429600Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1f69937a"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226745,"stop":1697105226750,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-abf9-7aea-b1e1-a87553ce6d1f', '018b235a-abf3-70c8-a32c-72ca2b72bb76', 'PENDING', now())","time":{"start":1697105226745,"stop":1697105226745,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-abf9-7aea-b1e1-a87553ce6d1f', '018b235a-abf3-70c8-a32c-72ca2b72bb76', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@717d3b2b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226750,"stop":1697105226755,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-abfe-7687-81e7-b732927d2d1c', '018b235a-abf3-70c8-a32c-72ca2b72bb76', 'ACTIVE', now())","time":{"start":1697105226750,"stop":1697105226750,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-abfe-7687-81e7-b732927d2d1c', '018b235a-abf3-70c8-a32c-72ca2b72bb76', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2f16c999"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226755,"stop":1697105226760,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:06.755260600Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-abf3-70c8-a32c-72ca2b72bb76'","time":{"start":1697105226755,"stop":1697105226755,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:06.755260600Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-abf3-70c8-a32c-72ca2b72bb76'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4f2de5f1"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-abae-747b-a482-ffa917bd1b8e/room-018b235a-abae-747b-a482-ffa917bd1b8e/publish","time":{"start":1697105226760,"stop":1697105226850,"duration":90},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-abae-747b-a482-ffa917bd1b8e/room-018b235a-abae-747b-a482-ffa917bd1b8e/publish","time":{"start":1697105226760,"stop":1697105226850,"duration":90},"status":"passed","steps":[],"attachments":[{"uid":"f56fddd58dc08563","name":"Request","source":"f56fddd58dc08563.html","type":"text/html","size":1160},{"uid":"fb9ab8b750e26450","name":"HTTP/1.1 200 OK","source":"fb9ab8b750e26450.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-abae-747b-a482-ffa917bd1b8e"},{"name":"roomId","value":"room-018b235a-abae-747b-a482-ffa917bd1b8e"},{"name":"message","value":"{eventType=EVENT-018b235a-abae-747b-a482-ffa917bd1b8e, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-abae-747b-a482-ffa917bd1b8e"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-abae-747b-a482-ffa917bd1b8e"},{"name":"roomId","value":"room-018b235a-abae-747b-a482-ffa917bd1b8e"},{"name":"message","value":"{eventType=EVENT-018b235a-abae-747b-a482-ffa917bd1b8e, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"when: message is pulled with a problem","time":{"start":1697105226851,"stop":1697105226851,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"GET /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-abae-747b-a482-ffa917bd1b8e/room-018b235a-abae-747b-a482-ffa917bd1b8e/pull","time":{"start":1697105226852,"stop":1697105226885,"duration":33},"status":"passed","steps":[],"attachments":[{"uid":"48040ec3f8249584","name":"Request","source":"48040ec3f8249584.html","type":"text/html","size":739},{"uid":"385c6a7ffbe7808c","name":"HTTP/1.1 500 Internal Server Error","source":"385c6a7ffbe7808c.html","type":"text/html","size":387}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-abae-747b-a482-ffa917bd1b8e"},{"name":"roomId","value":"room-018b235a-abae-747b-a482-ffa917bd1b8e"},{"name":"subscriptionId","value":"018b235a-abf3-70c8-a32c-72ca2b72bb76"},{"name":"header","value":"X-Road-Client=non-existent"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: pull fails","time":{"start":1697105226885,"stop":1697105226885,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105226903,"stop":1697105226903,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"stepsCount":15},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PullTests"},{"name":"testMethod","value":"Given: event type with 1 active PULL subscription; When: message is pulled with problem ''X-Road-Client' header not matching 'memberId''; Then: pull fails with 500"},{"name":"suite","value":"PullTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.3 - Unsuccessful pull"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"GET /rooms/{memberId}/{roomId}/pull"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Technical error: ([a-f0-9]{8}(-[a-f0-9]{4}){4}[a-f0-9]{8})"},{"name":"problem","value":"'X-Road-Client' header not matching 'memberId'"},{"name":"statusCode","value":"500"}],"links":[{"name":"UC6.3","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"7a67a4317788a9a9.json","parameterValues":["Technical error: ([a-f0-9]{8}(-[a-f0-9]{4}){4}[a-f0-9]{8})","'X-Road-Client' header not matching 'memberId'","500"]}