{"uid":"d9b10aca99aaa4e1","name":"Given: an event type; When: a message has a problem with 'X-Road-Client' header not matching memberId; Then: publish fails with 'Technical error'","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests.Given: an event type; When: a message has a problem with 'X-Road-Client' header #xRoadHeader; Then: publish fails with 'Technical error'","historyId":"af590bb468074a2d049654a65bb10ef0","time":{"start":1697105222736,"stop":1697105222905,"duration":169},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup","time":{"start":1697105222736,"stop":1697105222813,"duration":77},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105222772,"stop":1697105222781,"duration":9},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-9c50-7dfb-9229-ca4410bb1d7f', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-9c50-7c21-b511-d2a6b9febbeb', now(), NULL)","time":{"start":1697105222772,"stop":1697105222772,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-9c50-7dfb-9229-ca4410bb1d7f', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-9c50-7c21-b511-d2a6b9febbeb', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4ef6a2fd"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105222782,"stop":1697105222788,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-9c7d-7f9b-a825-df9b64c4f984', '018b235a-9c50-7dfb-9229-ca4410bb1d7f', 'room-018b235a-9c50-7c21-b511-d2a6b9febbeb', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:07:02.781484Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105222782,"stop":1697105222782,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-9c7d-7f9b-a825-df9b64c4f984', '018b235a-9c50-7dfb-9229-ca4410bb1d7f', 'room-018b235a-9c50-7c21-b511-d2a6b9febbeb', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:07:02.781484Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@7dcc5e9d"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105222788,"stop":1697105222795,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-9c84-788e-beb0-2f1be8c39a41', '018b235a-9c7d-7f9b-a825-df9b64c4f984', 'EVENT-018b235a-9c50-7c21-b511-d2a6b9febbeb', '[{\"at\": \"2023-10-12T10:07:02.788746100Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105222788,"stop":1697105222788,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-9c84-788e-beb0-2f1be8c39a41', '018b235a-9c7d-7f9b-a825-df9b64c4f984', 'EVENT-018b235a-9c50-7c21-b511-d2a6b9febbeb', '[{\"at\": \"2023-10-12T10:07:02.788746100Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4611fe60"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105222796,"stop":1697105222801,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-9c8b-7392-aa0f-38789894e446', '018b235a-9c84-788e-beb0-2f1be8c39a41', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:07:02.795515800Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105222796,"stop":1697105222796,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-9c8b-7392-aa0f-38789894e446', '018b235a-9c84-788e-beb0-2f1be8c39a41', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:07:02.795515800Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@42adf242"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105222802,"stop":1697105222806,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-9c91-7164-bb48-6848e09fd4f2', '018b235a-9c7d-7f9b-a825-df9b64c4f984', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-9c50-7c21-b511-d2a6b9febbeb', '[{\"at\": \"2023-10-12T10:07:02.801817700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105222802,"stop":1697105222802,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-9c91-7164-bb48-6848e09fd4f2', '018b235a-9c7d-7f9b-a825-df9b64c4f984', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-9c50-7c21-b511-d2a6b9febbeb', '[{\"at\": \"2023-10-12T10:07:02.801817700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@393751a0"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105222806,"stop":1697105222813,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-9c96-7897-81dc-b4ca27cd69dc', '018b235a-9c91-7164-bb48-6848e09fd4f2', '018b235a-9c84-788e-beb0-2f1be8c39a41', now(), NULL)","time":{"start":1697105222806,"stop":1697105222806,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-9c96-7897-81dc-b4ca27cd69dc', '018b235a-9c91-7164-bb48-6848e09fd4f2', '018b235a-9c84-788e-beb0-2f1be8c39a41', now(), NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2690d8ad"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":12}],"testStage":{"status":"passed","steps":[{"name":"given: an event type","time":{"start":1697105222815,"stop":1697105222815,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"when: message with a problem is published","time":{"start":1697105222816,"stop":1697105222816,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-9c50-7c21-b511-d2a6b9febbeb/room-018b235a-9c50-7c21-b511-d2a6b9febbeb/publish","time":{"start":1697105222817,"stop":1697105222856,"duration":39},"status":"passed","steps":[],"attachments":[{"uid":"5c28cd7f00b6268b","name":"Request","source":"5c28cd7f00b6268b.html","type":"text/html","size":1058},{"uid":"c8a2caca6e654635","name":"HTTP/1.1 500 Internal Server Error","source":"c8a2caca6e654635.html","type":"text/html","size":387}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-9c50-7c21-b511-d2a6b9febbeb"},{"name":"roomId","value":"room-018b235a-9c50-7c21-b511-d2a6b9febbeb"},{"name":"message","value":"{eventType=EVENT-018b235a-9c50-7c21-b511-d2a6b9febbeb, content={payload=test}}"},{"name":"header","value":"X-Road-Client=non-existent"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: publish fails","time":{"start":1697105222856,"stop":1697105222856,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"and: no events created","time":{"start":1697105222900,"stop":1697105222900,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105222900,"stop":1697105222904,"duration":4},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105222900,"stop":1697105222904,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-9c7d-7f9b-a825-df9b64c4f984'\n  AND event_type_version_id = '018b235a-9c8b-7392-aa0f-38789894e446'\n  AND event_type_id = '018b235a-9c84-788e-beb0-2f1be8c39a41'\n  AND publisher_id = '018b235a-9c91-7164-bb48-6848e09fd4f2'","time":{"start":1697105222900,"stop":1697105222900,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-9c7d-7f9b-a825-df9b64c4f984'\n  AND event_type_version_id = '018b235a-9c8b-7392-aa0f-38789894e446'\n  AND event_type_id = '018b235a-9c84-788e-beb0-2f1be8c39a41'\n  AND publisher_id = '018b235a-9c91-7164-bb48-6848e09fd4f2'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3fddd5c8"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(0):","time":{"start":1697105222904,"stop":1697105222904,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-9c7d-7f9b-a825-df9b64c4f984'\n  AND event_type_version_id = '018b235a-9c8b-7392-aa0f-38789894e446'\n  AND event_type_id = '018b235a-9c84-788e-beb0-2f1be8c39a41'\n  AND publisher_id = '018b235a-9c91-7164-bb48-6848e09fd4f2'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":3},{"name":"where","time":{"start":1697105222904,"stop":1697105222904,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":10},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests"},{"name":"testMethod","value":"Given: an event type; When: a message has a problem with 'X-Road-Client' header not matching memberId; Then: publish fails with 'Technical error'"},{"name":"suite","value":"PublishTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.1 - Unsuccessful publish"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"POST /rooms/{memberId}/{roomId}/publish"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"xRoadHeader","value":"not matching memberId"}],"links":[{"name":"UC6.1","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"d9b10aca99aaa4e1.json","parameterValues":["not matching memberId"]}