{"uid":"661eb47ccdb975cb","name":"Given: an event type with 1 active PULL subscription; When: message is published; Then: publish succeeds and 1 event is created, published","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests.Given: an event type with 1 active PULL subscription; When: message is published; Then: publish succeeds and 1 event is created, published","historyId":"5e102cf9036c16636fb9153821c3080b","time":{"start":1697105213637,"stop":1697105214399,"duration":762},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: an event type with 1 active PULL subscription","time":{"start":1697105213720,"stop":1697105213720,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105213722,"stop":1697105213728,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-7919-771b-8759-268235b600ec', '018b235a-78f4-73a4-896c-8da12683663b', '018b235a-78fc-7337-9510-0cc7e7b71214', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-78c6-7a63-9868-4db02ad3e28d', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:53.722067100Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105213722,"stop":1697105213722,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-7919-771b-8759-268235b600ec', '018b235a-78f4-73a4-896c-8da12683663b', '018b235a-78fc-7337-9510-0cc7e7b71214', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-78c6-7a63-9868-4db02ad3e28d', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:53.722067100Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@7f9f66c3"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213729,"stop":1697105213734,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-7920-75a7-bdc8-3f7826fe5206', '018b235a-7919-771b-8759-268235b600ec', 'PENDING', now())","time":{"start":1697105213729,"stop":1697105213729,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-7920-75a7-bdc8-3f7826fe5206', '018b235a-7919-771b-8759-268235b600ec', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@366ed5c7"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213735,"stop":1697105213741,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-7927-7b32-bef2-9c5591d00706', '018b235a-7919-771b-8759-268235b600ec', 'ACTIVE', now())","time":{"start":1697105213735,"stop":1697105213735,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-7927-7b32-bef2-9c5591d00706', '018b235a-7919-771b-8759-268235b600ec', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@30360716"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213741,"stop":1697105213746,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:53.741298500Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-7919-771b-8759-268235b600ec'","time":{"start":1697105213741,"stop":1697105213741,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:53.741298500Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-7919-771b-8759-268235b600ec'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6232025"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: message is published","time":{"start":1697105213747,"stop":1697105213747,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-78c6-7a63-9868-4db02ad3e28d/room-018b235a-78c6-7a63-9868-4db02ad3e28d/publish","time":{"start":1697105213747,"stop":1697105214351,"duration":604},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-78c6-7a63-9868-4db02ad3e28d/room-018b235a-78c6-7a63-9868-4db02ad3e28d/publish","time":{"start":1697105213747,"stop":1697105214351,"duration":604},"status":"passed","steps":[],"attachments":[{"uid":"2f124d5ad4457eb2","name":"Request","source":"2f124d5ad4457eb2.html","type":"text/html","size":1160},{"uid":"8c391c1022cac8c6","name":"HTTP/1.1 200 OK","source":"8c391c1022cac8c6.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-78c6-7a63-9868-4db02ad3e28d"},{"name":"roomId","value":"room-018b235a-78c6-7a63-9868-4db02ad3e28d"},{"name":"message","value":"{eventType=EVENT-018b235a-78c6-7a63-9868-4db02ad3e28d, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-78c6-7a63-9868-4db02ad3e28d"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-78c6-7a63-9868-4db02ad3e28d"},{"name":"roomId","value":"room-018b235a-78c6-7a63-9868-4db02ad3e28d"},{"name":"message","value":"{eventType=EVENT-018b235a-78c6-7a63-9868-4db02ad3e28d, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"then: publish succeeds","time":{"start":1697105214352,"stop":1697105214352,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"and: 1 event is created","time":{"start":1697105214353,"stop":1697105214353,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105214354,"stop":1697105214360,"duration":6},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105214354,"stop":1697105214360,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-78f4-73a4-896c-8da12683663b'\n  AND event_type_version_id = '018b235a-7903-76e6-85f2-574aaa5ff9d3'\n  AND event_type_id = '018b235a-78fc-7337-9510-0cc7e7b71214'\n  AND publisher_id = '018b235a-790b-798f-8c87-34282509be91'","time":{"start":1697105214354,"stop":1697105214354,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-78f4-73a4-896c-8da12683663b'\n  AND event_type_version_id = '018b235a-7903-76e6-85f2-574aaa5ff9d3'\n  AND event_type_id = '018b235a-78fc-7337-9510-0cc7e7b71214'\n  AND publisher_id = '018b235a-790b-798f-8c87-34282509be91'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@472bcf53"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(1):","time":{"start":1697105214360,"stop":1697105214360,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"[id:018b235a-7978-7c91-ad35-f8457d017cd0, room_id:018b235a-78f4-73a4-896c-8da12683663b, event_type_version_id:018b235a-7903-76e6-85f2-574aaa5ff9d3, event_type_id:018b235a-78fc-7337-9510-0cc7e7b71214, publisher_id:018b235a-790b-798f-8c87-34282509be91, correlation_id:018b235a-7978-7522-aeca-4299420da2d3, created_at:2023-10-12 13:06:53.816637]","time":{"start":1697105214360,"stop":1697105214360,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-78f4-73a4-896c-8da12683663b'\n  AND event_type_version_id = '018b235a-7903-76e6-85f2-574aaa5ff9d3'\n  AND event_type_id = '018b235a-78fc-7337-9510-0cc7e7b71214'\n  AND publisher_id = '018b235a-790b-798f-8c87-34282509be91'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":4},{"name":"and: the event is published","time":{"start":1697105214392,"stop":1697105214392,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105214393,"stop":1697105214397,"duration":4},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105214393,"stop":1697105214396,"duration":3},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7978-7c91-ad35-f8457d017cd0'\n  AND published_at IS NOT NULL  AND subscription_id = '018b235a-7919-771b-8759-268235b600ec'","time":{"start":1697105214393,"stop":1697105214393,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7978-7c91-ad35-f8457d017cd0'\n  AND published_at IS NOT NULL  AND subscription_id = '018b235a-7919-771b-8759-268235b600ec'\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@7c705090"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(1):","time":{"start":1697105214396,"stop":1697105214396,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"[id:018b235a-7987-748c-88c8-113f6e32f577, event_id:018b235a-7978-7c91-ad35-f8457d017cd0, subscription_id:018b235a-7919-771b-8759-268235b600ec, published_at:2023-10-12 13:06:53.831396, delivered_at:null]","time":{"start":1697105214396,"stop":1697105214396,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7978-7c91-ad35-f8457d017cd0'\n  AND published_at IS NOT NULL  AND subscription_id = '018b235a-7919-771b-8759-268235b600ec'\n"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":4}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":25},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests"},{"name":"testMethod","value":"Given: an event type with 1 active PULL subscription; When: message is published; Then: publish succeeds and 1 event is created, published"},{"name":"suite","value":"PublishTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.1 - Successful publish"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"POST /rooms/{memberId}/{roomId}/publish"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[{"name":"UC6.1","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"661eb47ccdb975cb.json","parameterValues":[]}