{"uid":"813b1e2ef9f26202","name":"Given: member's subscription; When: member unsubscribes with problem 'subscription in another room'; Then: unsubscribe fails with 404","fullName":"com.govstack.information_mediator.pubsub.api.management.subscriptions.UnsubscribeTests.Given: member's subscription; When: member unsubscribes with problem '#problem'; Then: unsubscribe fails with #statusCode","historyId":"3f6953fc47a3bcc24e5a265f901df8d0","time":{"start":1697105209060,"stop":1697105209234,"duration":174},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: member's subscription","time":{"start":1697105209120,"stop":1697105209120,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105209120,"stop":1697105209125,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6720-7c6a-8dae-d03ae97f6c10', '018b235a-670a-7f56-8842-57a50cf1ee7e', '018b235a-6711-70c7-8f33-99dcd228b7b4', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-66e4-7f37-9164-dcbbdf3d98c4', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:49.120405500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209120,"stop":1697105209120,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6720-7c6a-8dae-d03ae97f6c10', '018b235a-670a-7f56-8842-57a50cf1ee7e', '018b235a-6711-70c7-8f33-99dcd228b7b4', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-66e4-7f37-9164-dcbbdf3d98c4', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:49.120405500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3dbe3bc4"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209125,"stop":1697105209131,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6725-7414-92f2-6cff0adec297', '018b235a-6720-7c6a-8dae-d03ae97f6c10', 'PENDING', now())","time":{"start":1697105209126,"stop":1697105209126,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6725-7414-92f2-6cff0adec297', '018b235a-6720-7c6a-8dae-d03ae97f6c10', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@69c071db"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209131,"stop":1697105209137,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-672b-7b12-a645-f5d6a1a0be5d', '018b235a-6720-7c6a-8dae-d03ae97f6c10', 'ACTIVE', now())","time":{"start":1697105209131,"stop":1697105209131,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-672b-7b12-a645-f5d6a1a0be5d', '018b235a-6720-7c6a-8dae-d03ae97f6c10', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@7740d2c"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209137,"stop":1697105209142,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:49.137072800Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-6720-7c6a-8dae-d03ae97f6c10'","time":{"start":1697105209137,"stop":1697105209137,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:49.137072800Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-6720-7c6a-8dae-d03ae97f6c10'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@5c7eeeb2"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: member unsubscribes with problem","time":{"start":1697105209142,"stop":1697105209142,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105209145,"stop":1697105209150,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-6739-751b-b372-e4cb4d723d49', '018b235a-66e4-76b4-8ffc-11a2c3fc4f02', '2-room-018b235a-66e4-7f37-9164-dcbbdf3d98c4', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:49.145506900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209145,"stop":1697105209145,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-6739-751b-b372-e4cb4d723d49', '018b235a-66e4-76b4-8ffc-11a2c3fc4f02', '2-room-018b235a-66e4-7f37-9164-dcbbdf3d98c4', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:49.145506900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@76ec6ae0"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209150,"stop":1697105209154,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-673e-7da8-9f60-af3b0a223dde', '018b235a-6739-751b-b372-e4cb4d723d49', '2-EVENT-018b235a-66e4-7f37-9164-dcbbdf3d98c4', '[{\"at\": \"2023-10-12T10:06:49.150599900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209151,"stop":1697105209151,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-673e-7da8-9f60-af3b0a223dde', '018b235a-6739-751b-b372-e4cb4d723d49', '2-EVENT-018b235a-66e4-7f37-9164-dcbbdf3d98c4', '[{\"at\": \"2023-10-12T10:06:49.150599900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@72cd5f41"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209155,"stop":1697105209159,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-6743-7b3a-a055-ae96a6ee8678', '018b235a-673e-7da8-9f60-af3b0a223dde', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:49.155379700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209155,"stop":1697105209155,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-6743-7b3a-a055-ae96a6ee8678', '018b235a-673e-7da8-9f60-af3b0a223dde', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:49.155379700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3baed0a9"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209161,"stop":1697105209165,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6748-71f7-8699-6917adfcf30c', '018b235a-6739-751b-b372-e4cb4d723d49', '018b235a-673e-7da8-9f60-af3b0a223dde', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-66e4-7f37-9164-dcbbdf3d98c4', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:49.161017500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209161,"stop":1697105209161,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6748-71f7-8699-6917adfcf30c', '018b235a-6739-751b-b372-e4cb4d723d49', '018b235a-673e-7da8-9f60-af3b0a223dde', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-66e4-7f37-9164-dcbbdf3d98c4', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:49.161017500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6fb03f5"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209165,"stop":1697105209169,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-674d-743a-b24c-2feab68ff26e', '018b235a-6748-71f7-8699-6917adfcf30c', 'PENDING', now())","time":{"start":1697105209166,"stop":1697105209166,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-674d-743a-b24c-2feab68ff26e', '018b235a-6748-71f7-8699-6917adfcf30c', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1355d2a0"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DELETE /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-66e4-7f37-9164-dcbbdf3d98c4/room-018b235a-66e4-7f37-9164-dcbbdf3d98c4/subscriptions/018b235a-6748-71f7-8699-6917adfcf30c","time":{"start":1697105209169,"stop":1697105209210,"duration":41},"status":"passed","steps":[],"attachments":[{"uid":"e92ab1cb6c38c3bf","name":"Request","source":"e92ab1cb6c38c3bf.html","type":"text/html","size":837},{"uid":"f1175af90956aed7","name":"HTTP/1.1 404 ","source":"f1175af90956aed7.html","type":"text/html","size":840}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-66e4-7f37-9164-dcbbdf3d98c4"},{"name":"roomId","value":"room-018b235a-66e4-7f37-9164-dcbbdf3d98c4"},{"name":"subscriptionId","value":"018b235a-6748-71f7-8699-6917adfcf30c"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-66e4-7f37-9164-dcbbdf3d98c4"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: unsubscribe fails","time":{"start":1697105209210,"stop":1697105209210,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105209234,"stop":1697105209234,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":23},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions.UnsubscribeTests"},{"name":"testMethod","value":"Given: member's subscription; When: member unsubscribes with problem 'subscription in another room'; Then: unsubscribe fails with 404"},{"name":"suite","value":"UnsubscribeTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC4.7 - Unsuccessful unsubscribe"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"DELETE /rooms/{memberId}/{roomId}/subscriptions/{subscriptionId}"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Subscription was not found"},{"name":"problem","value":"subscription in another room"},{"name":"statusCode","value":"404"}],"links":[{"name":"UC4.7","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"813b1e2ef9f26202.json","parameterValues":["Subscription was not found","subscription in another room","404"]}