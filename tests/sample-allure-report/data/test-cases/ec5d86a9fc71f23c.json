{"uid":"ec5d86a9fc71f23c","name":"Given: an event type; When: a message with problem 'event type publish not allowed for publisher' is published; Then: publish fails with 404: 'Event Type was not found' ","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests.Given: an event type; When: a message with problem '#problem' is published; Then: publish fails with #errorCode: '#errorMessage' ","historyId":"a934e97faadd3df773eafdc0c2d2c5d7","time":{"start":1697105221307,"stop":1697105221485,"duration":178},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: an event type","time":{"start":1697105221380,"stop":1697105221380,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"when: message with a problem is published","time":{"start":1697105221380,"stop":1697105221380,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105221382,"stop":1697105221387,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-9706-74a0-ae72-7c97f455c5ca', '018b235a-96e2-756d-9bb9-07e967641118', 'EVENT2-018b235a-96bc-75b1-bdd1-19b94103b141', '[{\"at\": \"2023-10-12T10:07:01.382431Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105221382,"stop":1697105221382,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-9706-74a0-ae72-7c97f455c5ca', '018b235a-96e2-756d-9bb9-07e967641118', 'EVENT2-018b235a-96bc-75b1-bdd1-19b94103b141', '[{\"at\": \"2023-10-12T10:07:01.382431Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@193c3354"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105221388,"stop":1697105221394,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-970c-71f2-9458-457a69d4b758', '018b235a-9706-74a0-ae72-7c97f455c5ca', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:07:01.388006200Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105221388,"stop":1697105221388,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-970c-71f2-9458-457a69d4b758', '018b235a-9706-74a0-ae72-7c97f455c5ca', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:07:01.388006200Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4cf52777"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-96bc-75b1-bdd1-19b94103b141/room-018b235a-96bc-75b1-bdd1-19b94103b141/publish","time":{"start":1697105221394,"stop":1697105221435,"duration":41},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-96bc-75b1-bdd1-19b94103b141/room-018b235a-96bc-75b1-bdd1-19b94103b141/publish","time":{"start":1697105221394,"stop":1697105221435,"duration":41},"status":"passed","steps":[],"attachments":[{"uid":"9c7a67e3dd5ab506","name":"Request","source":"9c7a67e3dd5ab506.html","type":"text/html","size":1162},{"uid":"8fa40ea74b92e06f","name":"HTTP/1.1 404 Not Found","source":"8fa40ea74b92e06f.html","type":"text/html","size":357}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-96bc-75b1-bdd1-19b94103b141"},{"name":"roomId","value":"room-018b235a-96bc-75b1-bdd1-19b94103b141"},{"name":"message","value":"{eventType=EVENT2-018b235a-96bc-75b1-bdd1-19b94103b141, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-96bc-75b1-bdd1-19b94103b141"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-96bc-75b1-bdd1-19b94103b141"},{"name":"roomId","value":"room-018b235a-96bc-75b1-bdd1-19b94103b141"},{"name":"message","value":"{eventType=EVENT2-018b235a-96bc-75b1-bdd1-19b94103b141, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"then: publish fails","time":{"start":1697105221436,"stop":1697105221436,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"and: no events created","time":{"start":1697105221481,"stop":1697105221481,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105221481,"stop":1697105221485,"duration":4},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105221481,"stop":1697105221485,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-96e2-756d-9bb9-07e967641118'\n  AND event_type_version_id = '018b235a-970c-71f2-9458-457a69d4b758'\n  AND event_type_id = '018b235a-96e7-7c0a-811b-88c5e8b9383f'\n  AND publisher_id = '018b235a-96f4-7284-a22a-4f2a057de80b'","time":{"start":1697105221481,"stop":1697105221481,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-96e2-756d-9bb9-07e967641118'\n  AND event_type_version_id = '018b235a-970c-71f2-9458-457a69d4b758'\n  AND event_type_id = '018b235a-96e7-7c0a-811b-88c5e8b9383f'\n  AND publisher_id = '018b235a-96f4-7284-a22a-4f2a057de80b'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@11553864"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(0):","time":{"start":1697105221485,"stop":1697105221485,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-96e2-756d-9bb9-07e967641118'\n  AND event_type_version_id = '018b235a-970c-71f2-9458-457a69d4b758'\n  AND event_type_id = '018b235a-96e7-7c0a-811b-88c5e8b9383f'\n  AND publisher_id = '018b235a-96f4-7284-a22a-4f2a057de80b'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":3},{"name":"where","time":{"start":1697105221485,"stop":1697105221485,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":15},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests"},{"name":"testMethod","value":"Given: an event type; When: a message with problem 'event type publish not allowed for publisher' is published; Then: publish fails with 404: 'Event Type was not found' "},{"name":"suite","value":"PublishTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.1 - Unsuccessful publish"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"POST /rooms/{memberId}/{roomId}/publish"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"errorCode","value":"404"},{"name":"errorMessage","value":"Event Type was not found"},{"name":"problem","value":"event type publish not allowed for publisher"}],"links":[{"name":"UC6.1","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"ec5d86a9fc71f23c.json","parameterValues":["404","Event Type was not found","event type publish not allowed for publisher"]}