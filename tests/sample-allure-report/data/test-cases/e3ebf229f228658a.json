{"uid":"e3ebf229f228658a","name":"Given: an active room with event type; When: member subscribes with problem: member already has 1 active PUSH subscription with the same pushUrl and subscriptionIdentifier for this event type; Then: subscribe fails with 500","fullName":"com.govstack.information_mediator.pubsub.api.management.subscriptions.SubscribeTests.Given: an active room with event type; When: member subscribes with problem: #problem; Then: subscribe fails with #statusCode","historyId":"f359df223a1a1bcb38037bdc61fe4d0c","time":{"start":1697105208040,"stop":1697105208245,"duration":205},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup","time":{"start":1697105208040,"stop":1697105208092,"duration":52},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105208070,"stop":1697105208075,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-62e8-74c4-a5d0-576278368056', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-62e8-77b3-9306-36a140ff5861', now(), NULL)","time":{"start":1697105208070,"stop":1697105208070,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-62e8-74c4-a5d0-576278368056', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-62e8-77b3-9306-36a140ff5861', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@34fb399b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105208076,"stop":1697105208081,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-630b-718f-8be6-f35a67bbd904', '018b235a-62e8-74c4-a5d0-576278368056', 'room-018b235a-62e8-77b3-9306-36a140ff5861', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:48.076119800Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105208076,"stop":1697105208076,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-630b-718f-8be6-f35a67bbd904', '018b235a-62e8-74c4-a5d0-576278368056', 'room-018b235a-62e8-77b3-9306-36a140ff5861', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:48.076119800Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@240f4328"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105208081,"stop":1697105208087,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-6311-7290-9c6d-0f2f50e27d6b', '018b235a-630b-718f-8be6-f35a67bbd904', 'EVENT-018b235a-62e8-77b3-9306-36a140ff5861', '[{\"at\": \"2023-10-12T10:06:48.081345500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105208081,"stop":1697105208081,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-6311-7290-9c6d-0f2f50e27d6b', '018b235a-630b-718f-8be6-f35a67bbd904', 'EVENT-018b235a-62e8-77b3-9306-36a140ff5861', '[{\"at\": \"2023-10-12T10:06:48.081345500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6cd8b2de"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105208087,"stop":1697105208092,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-6317-73c6-8723-904269517255', '018b235a-6311-7290-9c6d-0f2f50e27d6b', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:48.087259900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105208087,"stop":1697105208087,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-6317-73c6-8723-904269517255', '018b235a-6311-7290-9c6d-0f2f50e27d6b', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:48.087259900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2f110efa"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":8}],"testStage":{"status":"passed","steps":[{"name":"given: an active room with event type","time":{"start":1697105208094,"stop":1697105208094,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"when: member subscribes with a problem","time":{"start":1697105208094,"stop":1697105208094,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"POST /rooms/subscription-018b235a-62e8-77b3-9306-36a140ff5861/room-018b235a-62e8-77b3-9306-36a140ff5861/subscriptions","time":{"start":1697105208099,"stop":1697105208150,"duration":51},"status":"passed","steps":[{"name":"POST /rooms/subscription-018b235a-62e8-77b3-9306-36a140ff5861/room-018b235a-62e8-77b3-9306-36a140ff5861/subscriptions","time":{"start":1697105208099,"stop":1697105208150,"duration":51},"status":"passed","steps":[],"attachments":[{"uid":"49e86a5c06c7c16e","name":"Request","source":"49e86a5c06c7c16e.html","type":"text/html","size":1220},{"uid":"a82a9c67d15a48c8","name":"HTTP/1.1 200 ","source":"a82a9c67d15a48c8.html","type":"text/html","size":789}],"parameters":[{"name":"memberId","value":"subscription-018b235a-62e8-77b3-9306-36a140ff5861"},{"name":"roomId","value":"room-018b235a-62e8-77b3-9306-36a140ff5861"},{"name":"body","value":"{method=PUSH, pushUrl=http://wiremock:8080/018b235a-6320-7410-ae50-6d16206c9958, eventType=EVENT-018b235a-62e8-77b3-9306-36a140ff5861}"},{"name":"header","value":"X-Road-Client=subscription-018b235a-62e8-77b3-9306-36a140ff5861"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"subscription-018b235a-62e8-77b3-9306-36a140ff5861"},{"name":"roomId","value":"room-018b235a-62e8-77b3-9306-36a140ff5861"},{"name":"body","value":"{method=PUSH, pushUrl=http://wiremock:8080/018b235a-6320-7410-ae50-6d16206c9958, eventType=EVENT-018b235a-62e8-77b3-9306-36a140ff5861}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/subscription-018b235a-62e8-77b3-9306-36a140ff5861/room-018b235a-62e8-77b3-9306-36a140ff5861/subscriptions","time":{"start":1697105208151,"stop":1697105208217,"duration":66},"status":"passed","steps":[],"attachments":[{"uid":"2bf1aa5606b8a082","name":"Request","source":"2bf1aa5606b8a082.html","type":"text/html","size":1220},{"uid":"c5f8c48f895d696c","name":"HTTP/1.1 500 ","source":"c5f8c48f895d696c.html","type":"text/html","size":820}],"parameters":[{"name":"memberId","value":"subscription-018b235a-62e8-77b3-9306-36a140ff5861"},{"name":"roomId","value":"room-018b235a-62e8-77b3-9306-36a140ff5861"},{"name":"body","value":"{method=PUSH, pushUrl=http://wiremock:8080/018b235a-6320-7410-ae50-6d16206c9958, eventType=EVENT-018b235a-62e8-77b3-9306-36a140ff5861}"},{"name":"header","value":"X-Road-Client=subscription-018b235a-62e8-77b3-9306-36a140ff5861"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: subscribe fails","time":{"start":1697105208217,"stop":1697105208217,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105208245,"stop":1697105208245,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"stepsCount":7},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions.SubscribeTests"},{"name":"testMethod","value":"Given: an active room with event type; When: member subscribes with problem: member already has 1 active PUSH subscription with the same pushUrl and subscriptionIdentifier for this event type; Then: subscribe fails with 500"},{"name":"suite","value":"SubscribeTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC4.1 - Unsuccessful subscribe"},{"name":"feature","value":"POST /rooms/{memberId}/{roomId}/subscriptions"},{"name":"epic","value":"Management-api"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Technical error: ([a-f0-9]{8}(-[a-f0-9]{4}){4}[a-f0-9]{8})"},{"name":"problem","value":"member already has 1 active PUSH subscription with the same pushUrl and subscriptionIdentifier for this event type"},{"name":"statusCode","value":"500"}],"links":[{"name":"UC4.1","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"e3ebf229f228658a.json","parameterValues":["Technical error: ([a-f0-9]{8}(-[a-f0-9]{4}){4}[a-f0-9]{8})","member already has 1 active PUSH subscription with the same pushUrl and subscriptionIdentifier for this event type","500"]}