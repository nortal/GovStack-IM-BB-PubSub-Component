{"uid":"aad259dc00ae4a2d","name":"Given: a manager with a room; When: manager terminates the room with a problem: 'X-Road-Client' header not matching 'memberId'; Then: terminating room fails with 403: Forbidden","fullName":"com.govstack.information_mediator.pubsub.api.management.rooms.DeleteRoomTests.Given: a manager with a room; When: manager terminates the room with a problem: #problem; Then: terminating room fails with #statusCode: #message","historyId":"108ad64f22760db39f7f901996b45570","time":{"start":1697105190002,"stop":1697105190337,"duration":335},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup","time":{"start":1697105190002,"stop":1697105190003,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"testStage":{"status":"passed","steps":[{"name":"given: a manager with a room","time":{"start":1697105190006,"stop":1697105190006,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105190039,"stop":1697105190044,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-1c76-7e38-9264-300df15bbb59', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-1c72-73da-8756-0a41ee8a4196', now(), NULL)","time":{"start":1697105190039,"stop":1697105190039,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-1c76-7e38-9264-300df15bbb59', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-1c72-73da-8756-0a41ee8a4196', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@47d7792e"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190044,"stop":1697105190049,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-1c9c-737e-bbad-364044ae9156', '018b235a-1c76-7e38-9264-300df15bbb59', 'room-018b235a-1c72-73da-8756-0a41ee8a4196', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:30.044091300Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105190044,"stop":1697105190044,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-1c9c-737e-bbad-364044ae9156', '018b235a-1c76-7e38-9264-300df15bbb59', 'room-018b235a-1c72-73da-8756-0a41ee8a4196', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:30.044091300Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4eb2a0c2"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190050,"stop":1697105190054,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-1ca1-76b5-83d5-0d628766609f', '018b235a-1c9c-737e-bbad-364044ae9156', 'EVENT-018b235a-1c72-73da-8756-0a41ee8a4196', '[{\"at\": \"2023-10-12T10:06:30.049583900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105190050,"stop":1697105190050,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-1ca1-76b5-83d5-0d628766609f', '018b235a-1c9c-737e-bbad-364044ae9156', 'EVENT-018b235a-1c72-73da-8756-0a41ee8a4196', '[{\"at\": \"2023-10-12T10:06:30.049583900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@10e7ade5"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190055,"stop":1697105190061,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-1ca6-75b7-a041-670e6fb74f48', '018b235a-1ca1-76b5-83d5-0d628766609f', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:30.055412700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105190055,"stop":1697105190056,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-1ca6-75b7-a041-670e6fb74f48', '018b235a-1ca1-76b5-83d5-0d628766609f', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:30.055412700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2fad48b7"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190062,"stop":1697105190069,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-1cad-7608-b720-95a2e96c4df0', '018b235a-1c9c-737e-bbad-364044ae9156', '018b235a-1ca1-76b5-83d5-0d628766609f', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-1c72-73da-8756-0a41ee8a4196', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:30.061405300Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105190062,"stop":1697105190062,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-1cad-7608-b720-95a2e96c4df0', '018b235a-1c9c-737e-bbad-364044ae9156', '018b235a-1ca1-76b5-83d5-0d628766609f', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-1c72-73da-8756-0a41ee8a4196', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:30.061405300Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@534f4a65"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190069,"stop":1697105190076,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1cb5-7d78-b699-7a941ea77fa8', '018b235a-1cad-7608-b720-95a2e96c4df0', 'PENDING', now())","time":{"start":1697105190070,"stop":1697105190070,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1cb5-7d78-b699-7a941ea77fa8', '018b235a-1cad-7608-b720-95a2e96c4df0', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@8a0447e"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190076,"stop":1697105190085,"duration":9},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1cbc-7850-84cf-1f1893748ef4', '018b235a-1cad-7608-b720-95a2e96c4df0', 'ACTIVE', now())","time":{"start":1697105190076,"stop":1697105190076,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1cbc-7850-84cf-1f1893748ef4', '018b235a-1cad-7608-b720-95a2e96c4df0', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2505480a"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190086,"stop":1697105190091,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:30.085580900Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-1cad-7608-b720-95a2e96c4df0'","time":{"start":1697105190086,"stop":1697105190086,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:30.085580900Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-1cad-7608-b720-95a2e96c4df0'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@602854ed"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190092,"stop":1697105190111,"duration":19},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-1ccb-7a4d-96fe-c6031364e666', '018b235a-1c9c-737e-bbad-364044ae9156', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-1c72-73da-8756-0a41ee8a4196', '[{\"at\": \"2023-10-12T10:06:30.091888300Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105190092,"stop":1697105190092,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-1ccb-7a4d-96fe-c6031364e666', '018b235a-1c9c-737e-bbad-364044ae9156', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-1c72-73da-8756-0a41ee8a4196', '[{\"at\": \"2023-10-12T10:06:30.091888300Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@491d36ef"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105190112,"stop":1697105190123,"duration":11},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-1cdf-7625-b059-3d670b9ee2f9', '018b235a-1ccb-7a4d-96fe-c6031364e666', '018b235a-1ca1-76b5-83d5-0d628766609f', now(), NULL)","time":{"start":1697105190112,"stop":1697105190112,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-1cdf-7625-b059-3d670b9ee2f9', '018b235a-1ccb-7a4d-96fe-c6031364e666', '018b235a-1ca1-76b5-83d5-0d628766609f', now(), NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@43941806"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: manager terminates the room","time":{"start":1697105190123,"stop":1697105190123,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DELETE /rooms/SANDBOX:ORG:TEST:MANAGER-018b235a-1c72-73da-8756-0a41ee8a4196/room-018b235a-1c72-73da-8756-0a41ee8a4196","time":{"start":1697105190124,"stop":1697105190200,"duration":76},"status":"passed","steps":[],"attachments":[{"uid":"121773092b5683c2","name":"Request","source":"121773092b5683c2.html","type":"text/html","size":625},{"uid":"25e5be05a3f0da86","name":"HTTP/1.1 403 ","source":"25e5be05a3f0da86.html","type":"text/html","size":1004}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:MANAGER-018b235a-1c72-73da-8756-0a41ee8a4196"},{"name":"roomId","value":"room-018b235a-1c72-73da-8756-0a41ee8a4196"},{"name":"header","value":"X-Road-Client=non-existent"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: terminating room fails","time":{"start":1697105190200,"stop":1697105190200,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105190336,"stop":1697105190336,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":25},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.rooms"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.rooms.DeleteRoomTests"},{"name":"testMethod","value":"Given: a manager with a room; When: manager terminates the room with a problem: 'X-Road-Client' header not matching 'memberId'; Then: terminating room fails with 403: Forbidden"},{"name":"suite","value":"DeleteRoomTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC3.10 - Unsuccessful room termination"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"DELETE /rooms/{memberId}/{roomId}"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Forbidden"},{"name":"problem","value":"'X-Road-Client' header not matching 'memberId'"},{"name":"statusCode","value":"403"}],"links":[{"name":"M604017-174","url":"https://jira.nortal.com/browse/M604017-174","type":"issue"},{"name":"UC3.10","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"aad259dc00ae4a2d.json","parameterValues":["Forbidden","'X-Road-Client' header not matching 'memberId'","403"]}