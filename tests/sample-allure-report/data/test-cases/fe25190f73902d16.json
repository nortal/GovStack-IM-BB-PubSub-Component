{"uid":"fe25190f73902d16","name":"Given: an event type with a PENDING subscription; When: message is published; Then: publish succeeds and event is created and no message is published","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests.Given: an event type with #subscriptionStatus; When: message is published; Then: publish succeeds and event is created and no message is published","historyId":"ea2079ebc9d421f067ea94f9435eca01","time":{"start":1697105212770,"stop":1697105213006,"duration":236},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: an event type with no active subscriptions","time":{"start":1697105212842,"stop":1697105212842,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105212845,"stop":1697105212855,"duration":10},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-75ac-7d35-91d9-688fa5917bfe', '018b235a-758b-7705-8c39-537bc04d1186', '018b235a-7591-7cf1-9c3f-e2eb0b80498f', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-7562-75c4-bbd9-194ced0ceff7', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:52.845279900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105212845,"stop":1697105212845,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-75ac-7d35-91d9-688fa5917bfe', '018b235a-758b-7705-8c39-537bc04d1186', '018b235a-7591-7cf1-9c3f-e2eb0b80498f', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-7562-75c4-bbd9-194ced0ceff7', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:52.845279900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4dbae8f"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105212856,"stop":1697105212861,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-75b8-726f-b973-9c9d308bf9eb', '018b235a-75ac-7d35-91d9-688fa5917bfe', 'PENDING', now())","time":{"start":1697105212856,"stop":1697105212856,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-75b8-726f-b973-9c9d308bf9eb', '018b235a-75ac-7d35-91d9-688fa5917bfe', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2ffa8ce5"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: message is published","time":{"start":1697105212861,"stop":1697105212861,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-7562-75c4-bbd9-194ced0ceff7/room-018b235a-7562-75c4-bbd9-194ced0ceff7/publish","time":{"start":1697105212862,"stop":1697105212971,"duration":109},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-7562-75c4-bbd9-194ced0ceff7/room-018b235a-7562-75c4-bbd9-194ced0ceff7/publish","time":{"start":1697105212862,"stop":1697105212971,"duration":109},"status":"passed","steps":[],"attachments":[{"uid":"fa05ddd4ed871104","name":"Request","source":"fa05ddd4ed871104.html","type":"text/html","size":1160},{"uid":"f83cf6e467666cf","name":"HTTP/1.1 200 OK","source":"f83cf6e467666cf.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-7562-75c4-bbd9-194ced0ceff7"},{"name":"roomId","value":"room-018b235a-7562-75c4-bbd9-194ced0ceff7"},{"name":"message","value":"{eventType=EVENT-018b235a-7562-75c4-bbd9-194ced0ceff7, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-7562-75c4-bbd9-194ced0ceff7"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-7562-75c4-bbd9-194ced0ceff7"},{"name":"roomId","value":"room-018b235a-7562-75c4-bbd9-194ced0ceff7"},{"name":"message","value":"{eventType=EVENT-018b235a-7562-75c4-bbd9-194ced0ceff7, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"then: publish succeeds","time":{"start":1697105212971,"stop":1697105212971,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"and: event is created","time":{"start":1697105212971,"stop":1697105212971,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105212971,"stop":1697105212975,"duration":4},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105212971,"stop":1697105212975,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-758b-7705-8c39-537bc04d1186'\n  AND event_type_version_id = '018b235a-7595-77aa-ada5-e484a9a614fc'\n  AND event_type_id = '018b235a-7591-7cf1-9c3f-e2eb0b80498f'\n  AND publisher_id = '018b235a-759b-7b56-94b8-eec170803cbe'","time":{"start":1697105212971,"stop":1697105212971,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-758b-7705-8c39-537bc04d1186'\n  AND event_type_version_id = '018b235a-7595-77aa-ada5-e484a9a614fc'\n  AND event_type_id = '018b235a-7591-7cf1-9c3f-e2eb0b80498f'\n  AND publisher_id = '018b235a-759b-7b56-94b8-eec170803cbe'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@60bd7262"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(1):","time":{"start":1697105212975,"stop":1697105212975,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"[id:018b235a-75f8-7238-9d30-2a01282fa446, room_id:018b235a-758b-7705-8c39-537bc04d1186, event_type_version_id:018b235a-7595-77aa-ada5-e484a9a614fc, event_type_id:018b235a-7591-7cf1-9c3f-e2eb0b80498f, publisher_id:018b235a-759b-7b56-94b8-eec170803cbe, correlation_id:018b235a-75f7-74ad-b2d0-4ba43fcd8eeb, created_at:2023-10-12 13:06:52.91982]","time":{"start":1697105212975,"stop":1697105212975,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-758b-7705-8c39-537bc04d1186'\n  AND event_type_version_id = '018b235a-7595-77aa-ada5-e484a9a614fc'\n  AND event_type_id = '018b235a-7591-7cf1-9c3f-e2eb0b80498f'\n  AND publisher_id = '018b235a-759b-7b56-94b8-eec170803cbe'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":4},{"name":"and: no message is published","time":{"start":1697105213001,"stop":1697105213001,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105213001,"stop":1697105213006,"duration":5},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105213001,"stop":1697105213006,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-75f8-7238-9d30-2a01282fa446'\n  AND published_at IS NOT NULL","time":{"start":1697105213002,"stop":1697105213002,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-75f8-7238-9d30-2a01282fa446'\n  AND published_at IS NOT NULL"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@51971d32"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(0):","time":{"start":1697105213006,"stop":1697105213006,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-75f8-7238-9d30-2a01282fa446'\n  AND published_at IS NOT NULL"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":3},{"name":"where","time":{"start":1697105213006,"stop":1697105213006,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":21},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests"},{"name":"testMethod","value":"Given: an event type with a PENDING subscription; When: message is published; Then: publish succeeds and event is created and no message is published"},{"name":"suite","value":"PublishTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.1 - Successful publish"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"POST /rooms/{memberId}/{roomId}/publish"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"subscriptionStatus","value":"a PENDING subscription"}],"links":[{"name":"UC6.1","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"fe25190f73902d16.json","parameterValues":["a PENDING subscription"]}