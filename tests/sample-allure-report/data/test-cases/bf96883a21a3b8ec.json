{"uid":"bf96883a21a3b8ec","name":"Given: a manager with a room; When: manager terminates the room with a problem: 'X-Road-Client' header missing; Then: terminating room fails with 403: Forbidden","fullName":"com.govstack.information_mediator.pubsub.api.management.rooms.DeleteRoomTests.Given: a manager with a room; When: manager terminates the room with a problem: #problem; Then: terminating room fails with #statusCode: #message","historyId":"faec7c9ee32727ec64b1db0fdfb74b1f","time":{"start":1697105189663,"stop":1697105189980,"duration":317},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: a manager with a room","time":{"start":1697105189672,"stop":1697105189672,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105189709,"stop":1697105189716,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-1b28-7d30-b750-91b8d02494f3', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-1b1f-7050-96b3-7aa8da9757eb', now(), NULL)","time":{"start":1697105189710,"stop":1697105189710,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-1b28-7d30-b750-91b8d02494f3', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-1b1f-7050-96b3-7aa8da9757eb', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4d92e9da"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189717,"stop":1697105189723,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-1b54-79dc-9fc6-62af4e93ca47', '018b235a-1b28-7d30-b750-91b8d02494f3', 'room-018b235a-1b1f-7050-96b3-7aa8da9757eb', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:29.716985Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105189717,"stop":1697105189717,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-1b54-79dc-9fc6-62af4e93ca47', '018b235a-1b28-7d30-b750-91b8d02494f3', 'room-018b235a-1b1f-7050-96b3-7aa8da9757eb', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:29.716985Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1baef878"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189724,"stop":1697105189730,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-1b5c-735c-abd6-0a1d16ad2aca', '018b235a-1b54-79dc-9fc6-62af4e93ca47', 'EVENT-018b235a-1b1f-7050-96b3-7aa8da9757eb', '[{\"at\": \"2023-10-12T10:06:29.724254900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105189725,"stop":1697105189725,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-1b5c-735c-abd6-0a1d16ad2aca', '018b235a-1b54-79dc-9fc6-62af4e93ca47', 'EVENT-018b235a-1b1f-7050-96b3-7aa8da9757eb', '[{\"at\": \"2023-10-12T10:06:29.724254900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6208f81c"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189730,"stop":1697105189739,"duration":9},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-1b62-757d-962e-99a6f803fa1e', '018b235a-1b5c-735c-abd6-0a1d16ad2aca', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:29.730448600Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105189731,"stop":1697105189731,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-1b62-757d-962e-99a6f803fa1e', '018b235a-1b5c-735c-abd6-0a1d16ad2aca', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:29.730448600Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@67d4e8f7"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189740,"stop":1697105189745,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-1b6b-7a12-a559-40b21e98c1c1', '018b235a-1b54-79dc-9fc6-62af4e93ca47', '018b235a-1b5c-735c-abd6-0a1d16ad2aca', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-1b1f-7050-96b3-7aa8da9757eb', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:29.739903900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105189740,"stop":1697105189740,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-1b6b-7a12-a559-40b21e98c1c1', '018b235a-1b54-79dc-9fc6-62af4e93ca47', '018b235a-1b5c-735c-abd6-0a1d16ad2aca', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-1b1f-7050-96b3-7aa8da9757eb', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:29.739903900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3d5211ee"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189746,"stop":1697105189752,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1b72-7426-866d-5e9522205162', '018b235a-1b6b-7a12-a559-40b21e98c1c1', 'PENDING', now())","time":{"start":1697105189746,"stop":1697105189746,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1b72-7426-866d-5e9522205162', '018b235a-1b6b-7a12-a559-40b21e98c1c1', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@51535304"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189752,"stop":1697105189757,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1b78-7bab-8d4a-d9b529640be8', '018b235a-1b6b-7a12-a559-40b21e98c1c1', 'ACTIVE', now())","time":{"start":1697105189752,"stop":1697105189752,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1b78-7bab-8d4a-d9b529640be8', '018b235a-1b6b-7a12-a559-40b21e98c1c1', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@74be992a"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189757,"stop":1697105189762,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:29.757790500Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-1b6b-7a12-a559-40b21e98c1c1'","time":{"start":1697105189758,"stop":1697105189758,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:29.757790500Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-1b6b-7a12-a559-40b21e98c1c1'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@346d441a"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189763,"stop":1697105189768,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-1b83-73d0-94ae-24a113b40b63', '018b235a-1b54-79dc-9fc6-62af4e93ca47', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-1b1f-7050-96b3-7aa8da9757eb', '[{\"at\": \"2023-10-12T10:06:29.763404200Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105189763,"stop":1697105189763,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-1b83-73d0-94ae-24a113b40b63', '018b235a-1b54-79dc-9fc6-62af4e93ca47', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-1b1f-7050-96b3-7aa8da9757eb', '[{\"at\": \"2023-10-12T10:06:29.763404200Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@199dee18"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105189768,"stop":1697105189773,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-1b88-7eec-ad72-fb0a386ae4d7', '018b235a-1b83-73d0-94ae-24a113b40b63', '018b235a-1b5c-735c-abd6-0a1d16ad2aca', now(), NULL)","time":{"start":1697105189768,"stop":1697105189768,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-1b88-7eec-ad72-fb0a386ae4d7', '018b235a-1b83-73d0-94ae-24a113b40b63', '018b235a-1b5c-735c-abd6-0a1d16ad2aca', now(), NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@521d455c"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: manager terminates the room","time":{"start":1697105189773,"stop":1697105189773,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DELETE /rooms/SANDBOX:ORG:TEST:MANAGER-018b235a-1b1f-7050-96b3-7aa8da9757eb/room-018b235a-1b1f-7050-96b3-7aa8da9757eb","time":{"start":1697105189781,"stop":1697105189856,"duration":75},"status":"passed","steps":[],"attachments":[{"uid":"8b518bfce6eb62c","name":"Request","source":"8b518bfce6eb62c.html","type":"text/html","size":537},{"uid":"338c976dc44c4c0","name":"HTTP/1.1 403 ","source":"338c976dc44c4c0.html","type":"text/html","size":1004}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:MANAGER-018b235a-1b1f-7050-96b3-7aa8da9757eb"},{"name":"roomId","value":"room-018b235a-1b1f-7050-96b3-7aa8da9757eb"},{"name":"header","value":"null"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: terminating room fails","time":{"start":1697105189856,"stop":1697105189856,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105189980,"stop":1697105189980,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":25},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.rooms"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.rooms.DeleteRoomTests"},{"name":"testMethod","value":"Given: a manager with a room; When: manager terminates the room with a problem: 'X-Road-Client' header missing; Then: terminating room fails with 403: Forbidden"},{"name":"suite","value":"DeleteRoomTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC3.10 - Unsuccessful room termination"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"DELETE /rooms/{memberId}/{roomId}"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Forbidden"},{"name":"problem","value":"'X-Road-Client' header missing"},{"name":"statusCode","value":"403"}],"links":[{"name":"M604017-174","url":"https://jira.nortal.com/browse/M604017-174","type":"issue"},{"name":"UC3.10","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"bf96883a21a3b8ec.json","parameterValues":["Forbidden","'X-Road-Client' header missing","403"]}