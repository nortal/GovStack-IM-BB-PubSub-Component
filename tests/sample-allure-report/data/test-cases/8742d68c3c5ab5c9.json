{"uid":"8742d68c3c5ab5c9","name":"Given: event type with 1 active PULL subscription; When: message is pulled with problem ''X-Road-Client' header missing'; Then: pull fails with 500","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PullTests.Given: event type with 1 active PULL subscription; When: message is pulled with problem '#problem'; Then: pull fails with #statusCode","historyId":"1a8ea529daf4f8fb1a15549d91c7fdf1","time":{"start":1697105226386,"stop":1697105226659,"duration":273},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: event type with 1 active PULL subscription","time":{"start":1697105226456,"stop":1697105226456,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105226457,"stop":1697105226463,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-aad8-7a28-923d-cef4a99e43f5', '018b235a-aab6-7973-b4d4-46b7b3653db4', '018b235a-aabf-7bf8-8199-adc31905a6d7', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-aa93-726e-b10b-2f69d8fe269f', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:06.456869Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105226457,"stop":1697105226457,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-aad8-7a28-923d-cef4a99e43f5', '018b235a-aab6-7973-b4d4-46b7b3653db4', '018b235a-aabf-7bf8-8199-adc31905a6d7', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-aa93-726e-b10b-2f69d8fe269f', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:06.456869Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@7dda1470"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226463,"stop":1697105226469,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-aadf-7d79-a790-9fed851f6bca', '018b235a-aad8-7a28-923d-cef4a99e43f5', 'PENDING', now())","time":{"start":1697105226463,"stop":1697105226463,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-aadf-7d79-a790-9fed851f6bca', '018b235a-aad8-7a28-923d-cef4a99e43f5', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@28e04625"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226470,"stop":1697105226476,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-aae5-7532-b84b-0dcaef17063c', '018b235a-aad8-7a28-923d-cef4a99e43f5', 'ACTIVE', now())","time":{"start":1697105226470,"stop":1697105226470,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-aae5-7532-b84b-0dcaef17063c', '018b235a-aad8-7a28-923d-cef4a99e43f5', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@130a38c5"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226477,"stop":1697105226483,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:06.476728300Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-aad8-7a28-923d-cef4a99e43f5'","time":{"start":1697105226477,"stop":1697105226477,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:06.476728300Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-aad8-7a28-923d-cef4a99e43f5'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@256f298e"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-aa93-726e-b10b-2f69d8fe269f/room-018b235a-aa93-726e-b10b-2f69d8fe269f/publish","time":{"start":1697105226484,"stop":1697105226589,"duration":105},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-aa93-726e-b10b-2f69d8fe269f/room-018b235a-aa93-726e-b10b-2f69d8fe269f/publish","time":{"start":1697105226484,"stop":1697105226589,"duration":105},"status":"passed","steps":[],"attachments":[{"uid":"2b96b776b48c04ed","name":"Request","source":"2b96b776b48c04ed.html","type":"text/html","size":1160},{"uid":"fe4de6808dc0f976","name":"HTTP/1.1 200 OK","source":"fe4de6808dc0f976.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-aa93-726e-b10b-2f69d8fe269f"},{"name":"roomId","value":"room-018b235a-aa93-726e-b10b-2f69d8fe269f"},{"name":"message","value":"{eventType=EVENT-018b235a-aa93-726e-b10b-2f69d8fe269f, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-aa93-726e-b10b-2f69d8fe269f"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-aa93-726e-b10b-2f69d8fe269f"},{"name":"roomId","value":"room-018b235a-aa93-726e-b10b-2f69d8fe269f"},{"name":"message","value":"{eventType=EVENT-018b235a-aa93-726e-b10b-2f69d8fe269f, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"when: message is pulled with a problem","time":{"start":1697105226590,"stop":1697105226590,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"GET /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-aa93-726e-b10b-2f69d8fe269f/room-018b235a-aa93-726e-b10b-2f69d8fe269f/pull","time":{"start":1697105226591,"stop":1697105226625,"duration":34},"status":"passed","steps":[],"attachments":[{"uid":"30cec10ece9bcbb5","name":"Request","source":"30cec10ece9bcbb5.html","type":"text/html","size":651},{"uid":"a70dbe2326d0ef9a","name":"HTTP/1.1 500 Internal Server Error","source":"a70dbe2326d0ef9a.html","type":"text/html","size":387}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-aa93-726e-b10b-2f69d8fe269f"},{"name":"roomId","value":"room-018b235a-aa93-726e-b10b-2f69d8fe269f"},{"name":"subscriptionId","value":"018b235a-aad8-7a28-923d-cef4a99e43f5"},{"name":"header","value":"null"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: pull fails","time":{"start":1697105226625,"stop":1697105226625,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105226659,"stop":1697105226659,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"stepsCount":15},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PullTests"},{"name":"testMethod","value":"Given: event type with 1 active PULL subscription; When: message is pulled with problem ''X-Road-Client' header missing'; Then: pull fails with 500"},{"name":"suite","value":"PullTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.3 - Unsuccessful pull"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"GET /rooms/{memberId}/{roomId}/pull"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Technical error: ([a-f0-9]{8}(-[a-f0-9]{4}){4}[a-f0-9]{8})"},{"name":"problem","value":"'X-Road-Client' header missing"},{"name":"statusCode","value":"500"}],"links":[{"name":"UC6.3","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"8742d68c3c5ab5c9.json","parameterValues":["Technical error: ([a-f0-9]{8}(-[a-f0-9]{4}){4}[a-f0-9]{8})","'X-Road-Client' header missing","500"]}