{"uid":"e78f383ff26209cc","name":"Given: member's subscription; When: member unsubscribes with problem 'terminated room'; Then: unsubscribe fails with 404","fullName":"com.govstack.information_mediator.pubsub.api.management.subscriptions.UnsubscribeTests.Given: member's subscription; When: member unsubscribes with problem '#problem'; Then: unsubscribe fails with #statusCode","historyId":"3ccad75a6a348f7607c32ff63704764e","time":{"start":1697105209404,"stop":1697105209578,"duration":174},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: member's subscription","time":{"start":1697105209460,"stop":1697105209460,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105209460,"stop":1697105209467,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6874-7b06-9fc4-b06394616a3a', '018b235a-6860-707d-a553-22e14f4d5700', '018b235a-6866-74af-bf87-176407559b81', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-683d-7a35-8187-864ff77a19a9', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:49.460427100Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209460,"stop":1697105209460,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6874-7b06-9fc4-b06394616a3a', '018b235a-6860-707d-a553-22e14f4d5700', '018b235a-6866-74af-bf87-176407559b81', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-683d-7a35-8187-864ff77a19a9', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:49.460427100Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1e60dce7"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209468,"stop":1697105209473,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-687b-7d40-a2e2-ff125e504f33', '018b235a-6874-7b06-9fc4-b06394616a3a', 'PENDING', now())","time":{"start":1697105209468,"stop":1697105209468,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-687b-7d40-a2e2-ff125e504f33', '018b235a-6874-7b06-9fc4-b06394616a3a', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@408db405"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209475,"stop":1697105209480,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6882-7eb4-9fe3-4fdcc2dfc99b', '018b235a-6874-7b06-9fc4-b06394616a3a', 'ACTIVE', now())","time":{"start":1697105209475,"stop":1697105209475,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6882-7eb4-9fe3-4fdcc2dfc99b', '018b235a-6874-7b06-9fc4-b06394616a3a', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@20d5668"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209481,"stop":1697105209486,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:49.480607300Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-6874-7b06-9fc4-b06394616a3a'","time":{"start":1697105209481,"stop":1697105209481,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:49.480607300Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-6874-7b06-9fc4-b06394616a3a'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2d66a5d3"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: member unsubscribes with problem","time":{"start":1697105209487,"stop":1697105209487,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105209489,"stop":1697105209498,"duration":9},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE rooms\nSET deleted_at = now()\nWHERE id = '018b235a-6860-707d-a553-22e14f4d5700'","time":{"start":1697105209489,"stop":1697105209489,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE rooms\nSET deleted_at = now()\nWHERE id = '018b235a-6860-707d-a553-22e14f4d5700'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@702fdf3b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DELETE /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-683d-7a35-8187-864ff77a19a9/room-018b235a-683d-7a35-8187-864ff77a19a9/subscriptions/018b235a-6874-7b06-9fc4-b06394616a3a","time":{"start":1697105209499,"stop":1697105209541,"duration":42},"status":"passed","steps":[],"attachments":[{"uid":"3573434864d0be50","name":"Request","source":"3573434864d0be50.html","type":"text/html","size":837},{"uid":"68dadbe45794bc34","name":"HTTP/1.1 404 ","source":"68dadbe45794bc34.html","type":"text/html","size":832}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-683d-7a35-8187-864ff77a19a9"},{"name":"roomId","value":"room-018b235a-683d-7a35-8187-864ff77a19a9"},{"name":"subscriptionId","value":"018b235a-6874-7b06-9fc4-b06394616a3a"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-683d-7a35-8187-864ff77a19a9"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: unsubscribe fails","time":{"start":1697105209541,"stop":1697105209541,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105209578,"stop":1697105209578,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":15},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions.UnsubscribeTests"},{"name":"testMethod","value":"Given: member's subscription; When: member unsubscribes with problem 'terminated room'; Then: unsubscribe fails with 404"},{"name":"suite","value":"UnsubscribeTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC4.7 - Unsuccessful unsubscribe"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"DELETE /rooms/{memberId}/{roomId}/subscriptions/{subscriptionId}"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Room was not found"},{"name":"problem","value":"terminated room"},{"name":"statusCode","value":"404"}],"links":[{"name":"UC4.7","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"e78f383ff26209cc.json","parameterValues":["Room was not found","terminated room","404"]}