{"uid":"d65006e0a8ba4eef","name":"Given: member's subscription; When: member unsubscribes with problem 'subscription already terminated'; Then: unsubscribe fails with 404","fullName":"com.govstack.information_mediator.pubsub.api.management.subscriptions.UnsubscribeTests.Given: member's subscription; When: member unsubscribes with problem '#problem'; Then: unsubscribe fails with #statusCode","historyId":"c0656ff775549ef90ba3f9ed378e29","time":{"start":1697105208612,"stop":1697105208862,"duration":250},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: member's subscription","time":{"start":1697105208665,"stop":1697105208665,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105208666,"stop":1697105208672,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6559-704f-8206-ccdb8bd9f164', '018b235a-6545-7e41-9f48-6a65e86cf249', '018b235a-6549-754e-bb5e-a4ad07534e35', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:48.666431Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105208666,"stop":1697105208667,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6559-704f-8206-ccdb8bd9f164', '018b235a-6545-7e41-9f48-6a65e86cf249', '018b235a-6549-754e-bb5e-a4ad07534e35', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:48.666431Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1a2d79bf"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105208672,"stop":1697105208677,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6560-7d42-896e-fbb68fad575e', '018b235a-6559-704f-8206-ccdb8bd9f164', 'PENDING', now())","time":{"start":1697105208673,"stop":1697105208673,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6560-7d42-896e-fbb68fad575e', '018b235a-6559-704f-8206-ccdb8bd9f164', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3eca0961"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105208678,"stop":1697105208684,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6566-748c-a7aa-b05aa5fce3fc', '018b235a-6559-704f-8206-ccdb8bd9f164', 'ACTIVE', now())","time":{"start":1697105208679,"stop":1697105208679,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6566-748c-a7aa-b05aa5fce3fc', '018b235a-6559-704f-8206-ccdb8bd9f164', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@57212116"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105208684,"stop":1697105208690,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:48.684813700Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-6559-704f-8206-ccdb8bd9f164'","time":{"start":1697105208684,"stop":1697105208684,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:48.684813700Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-6559-704f-8206-ccdb8bd9f164'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2c689e6d"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: member unsubscribes with problem","time":{"start":1697105208692,"stop":1697105208692,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DELETE /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3/room-018b235a-6524-722c-8430-20cb3df214b3/subscriptions/018b235a-6559-704f-8206-ccdb8bd9f164","time":{"start":1697105208706,"stop":1697105208773,"duration":67},"status":"passed","steps":[{"name":"DELETE /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3/room-018b235a-6524-722c-8430-20cb3df214b3/subscriptions/018b235a-6559-704f-8206-ccdb8bd9f164","time":{"start":1697105208706,"stop":1697105208773,"duration":67},"status":"passed","steps":[],"attachments":[{"uid":"79685ed1b3b68f6","name":"Request","source":"79685ed1b3b68f6.html","type":"text/html","size":837},{"uid":"9a891cb30ced5af","name":"HTTP/1.1 200 ","source":"9a891cb30ced5af.html","type":"text/html","size":646}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3"},{"name":"roomId","value":"room-018b235a-6524-722c-8430-20cb3df214b3"},{"name":"subscriptionId","value":"018b235a-6559-704f-8206-ccdb8bd9f164"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3"},{"name":"roomId","value":"room-018b235a-6524-722c-8430-20cb3df214b3"},{"name":"subscriptionId","value":"018b235a-6559-704f-8206-ccdb8bd9f164"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"DELETE /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3/room-018b235a-6524-722c-8430-20cb3df214b3/subscriptions/018b235a-6559-704f-8206-ccdb8bd9f164","time":{"start":1697105208777,"stop":1697105208831,"duration":54},"status":"passed","steps":[],"attachments":[{"uid":"c5df42647024e563","name":"Request","source":"c5df42647024e563.html","type":"text/html","size":837},{"uid":"bc820b98f07c9b87","name":"HTTP/1.1 404 ","source":"bc820b98f07c9b87.html","type":"text/html","size":840}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3"},{"name":"roomId","value":"room-018b235a-6524-722c-8430-20cb3df214b3"},{"name":"subscriptionId","value":"018b235a-6559-704f-8206-ccdb8bd9f164"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-6524-722c-8430-20cb3df214b3"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: unsubscribe fails","time":{"start":1697105208832,"stop":1697105208832,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105208861,"stop":1697105208861,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"stepsCount":15},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions.UnsubscribeTests"},{"name":"testMethod","value":"Given: member's subscription; When: member unsubscribes with problem 'subscription already terminated'; Then: unsubscribe fails with 404"},{"name":"suite","value":"UnsubscribeTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC4.7 - Unsuccessful unsubscribe"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"DELETE /rooms/{memberId}/{roomId}/subscriptions/{subscriptionId}"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Subscription was not found"},{"name":"problem","value":"subscription already terminated"},{"name":"statusCode","value":"404"}],"links":[{"name":"UC4.7","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"d65006e0a8ba4eef.json","parameterValues":["Subscription was not found","subscription already terminated","404"]}