{"uid":"8cbd44d9c2e614d","name":"Given: a manager with a room; When: manager terminates the room with a problem: non-existent manager; Then: terminating room fails with 403: Forbidden","fullName":"com.govstack.information_mediator.pubsub.api.management.rooms.DeleteRoomTests.Given: a manager with a room; When: manager terminates the room with a problem: #problem; Then: terminating room fails with #statusCode: #message","historyId":"7411f7888edf5fcf90457e6bcc77696d","time":{"start":1697105185142,"stop":1697105188245,"duration":3103},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: a manager with a room","time":{"start":1697105185149,"stop":1697105185149,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105185274,"stop":1697105185281,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-0984-7841-98fb-3c9b0e130037', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-0977-73b6-bbe2-2615e14257bd', now(), NULL)","time":{"start":1697105185275,"stop":1697105185275,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-0984-7841-98fb-3c9b0e130037', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-0977-73b6-bbe2-2615e14257bd', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3204146d"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185283,"stop":1697105185290,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-0a03-7372-b665-c151442059cf', '018b235a-0984-7841-98fb-3c9b0e130037', 'room-018b235a-0977-73b6-bbe2-2615e14257bd', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:25.283042900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105185284,"stop":1697105185284,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-0a03-7372-b665-c151442059cf', '018b235a-0984-7841-98fb-3c9b0e130037', 'room-018b235a-0977-73b6-bbe2-2615e14257bd', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:25.283042900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3299e315"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185292,"stop":1697105185300,"duration":8},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-0a0b-7541-9f45-92bd58dd8153', '018b235a-0a03-7372-b665-c151442059cf', 'EVENT-018b235a-0977-73b6-bbe2-2615e14257bd', '[{\"at\": \"2023-10-12T10:06:25.291765400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105185292,"stop":1697105185292,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-0a0b-7541-9f45-92bd58dd8153', '018b235a-0a03-7372-b665-c151442059cf', 'EVENT-018b235a-0977-73b6-bbe2-2615e14257bd', '[{\"at\": \"2023-10-12T10:06:25.291765400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@7320bccc"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185302,"stop":1697105185310,"duration":8},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-0a15-745e-a2cc-8daef6f8196b', '018b235a-0a0b-7541-9f45-92bd58dd8153', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:25.301766900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105185302,"stop":1697105185302,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-0a15-745e-a2cc-8daef6f8196b', '018b235a-0a0b-7541-9f45-92bd58dd8153', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:25.301766900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@403ba39f"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185314,"stop":1697105185335,"duration":21},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-0a1f-7cb5-b897-27bb4a084cf9', '018b235a-0a03-7372-b665-c151442059cf', '018b235a-0a0b-7541-9f45-92bd58dd8153', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-0977-73b6-bbe2-2615e14257bd', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:25.312663500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105185315,"stop":1697105185315,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-0a1f-7cb5-b897-27bb4a084cf9', '018b235a-0a03-7372-b665-c151442059cf', '018b235a-0a0b-7541-9f45-92bd58dd8153', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-0977-73b6-bbe2-2615e14257bd', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:25.312663500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@520e6089"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185336,"stop":1697105185342,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-0a38-7afd-815c-ce96066a9f9b', '018b235a-0a1f-7cb5-b897-27bb4a084cf9', 'PENDING', now())","time":{"start":1697105185336,"stop":1697105185337,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-0a38-7afd-815c-ce96066a9f9b', '018b235a-0a1f-7cb5-b897-27bb4a084cf9', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2ff2a096"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185350,"stop":1697105185357,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-0a45-74b6-905c-7278ec8a5edd', '018b235a-0a1f-7cb5-b897-27bb4a084cf9', 'ACTIVE', now())","time":{"start":1697105185350,"stop":1697105185350,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-0a45-74b6-905c-7278ec8a5edd', '018b235a-0a1f-7cb5-b897-27bb4a084cf9', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6be865c1"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185373,"stop":1697105185380,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:25.371469800Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-0a1f-7cb5-b897-27bb4a084cf9'","time":{"start":1697105185373,"stop":1697105185373,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:25.371469800Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-0a1f-7cb5-b897-27bb4a084cf9'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@14f11a56"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185381,"stop":1697105185388,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-0a65-730b-8571-05bae91a7b83', '018b235a-0a03-7372-b665-c151442059cf', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-0977-73b6-bbe2-2615e14257bd', '[{\"at\": \"2023-10-12T10:06:25.381363Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105185382,"stop":1697105185382,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-0a65-730b-8571-05bae91a7b83', '018b235a-0a03-7372-b665-c151442059cf', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-0977-73b6-bbe2-2615e14257bd', '[{\"at\": \"2023-10-12T10:06:25.381363Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@543b855"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105185390,"stop":1697105185399,"duration":9},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-0a6d-71b7-8e4c-9c4671c919c2', '018b235a-0a65-730b-8571-05bae91a7b83', '018b235a-0a0b-7541-9f45-92bd58dd8153', now(), NULL)","time":{"start":1697105185390,"stop":1697105185390,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-0a6d-71b7-8e4c-9c4671c919c2', '018b235a-0a65-730b-8571-05bae91a7b83', '018b235a-0a0b-7541-9f45-92bd58dd8153', now(), NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@197c3101"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: manager terminates the room","time":{"start":1697105185400,"stop":1697105185400,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DELETE /rooms/non-existent/room-018b235a-0977-73b6-bbe2-2615e14257bd","time":{"start":1697105185407,"stop":1697105185857,"duration":450},"status":"passed","steps":[],"attachments":[{"uid":"7487a43b6117de35","name":"Request","source":"7487a43b6117de35.html","type":"text/html","size":613},{"uid":"96d9f5ebe12eabb4","name":"HTTP/1.1 403 ","source":"96d9f5ebe12eabb4.html","type":"text/html","size":949}],"parameters":[{"name":"memberId","value":"non-existent"},{"name":"roomId","value":"room-018b235a-0977-73b6-bbe2-2615e14257bd"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:MANAGER-018b235a-0977-73b6-bbe2-2615e14257bd"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: terminating room fails","time":{"start":1697105185858,"stop":1697105185858,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105188244,"stop":1697105188244,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":25},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.rooms"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.rooms.DeleteRoomTests"},{"name":"testMethod","value":"Given: a manager with a room; When: manager terminates the room with a problem: non-existent manager; Then: terminating room fails with 403: Forbidden"},{"name":"suite","value":"DeleteRoomTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC3.10 - Unsuccessful room termination"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"DELETE /rooms/{memberId}/{roomId}"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Forbidden"},{"name":"problem","value":"non-existent manager"},{"name":"statusCode","value":"403"}],"links":[{"name":"M604017-174","url":"https://jira.nortal.com/browse/M604017-174","type":"issue"},{"name":"UC3.10","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"8cbd44d9c2e614d.json","parameterValues":["Forbidden","non-existent manager","403"]}