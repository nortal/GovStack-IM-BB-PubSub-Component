{"uid":"dab7c6c99d9b7e97","name":"Given: an event type with a TERMINATED subscription; When: message is published; Then: publish succeeds and event is created and no message is published","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests.Given: an event type with #subscriptionStatus; When: message is published; Then: publish succeeds and event is created and no message is published","historyId":"8fdacd8d156d1c99a6f0c1f9be537313","time":{"start":1697105213015,"stop":1697105213276,"duration":261},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: an event type with no active subscriptions","time":{"start":1697105213091,"stop":1697105213091,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105213094,"stop":1697105213100,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-76a6-7275-8def-b4619b5e9704', '018b235a-767f-7a8d-aa39-5a2dca74b0a6', '018b235a-7687-7c2e-a712-3440e3c32062', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-7657-70ab-a0ef-58181b34b0b8', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:53.094266900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105213094,"stop":1697105213094,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-76a6-7275-8def-b4619b5e9704', '018b235a-767f-7a8d-aa39-5a2dca74b0a6', '018b235a-7687-7c2e-a712-3440e3c32062', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-7657-70ab-a0ef-58181b34b0b8', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:53.094266900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@12e75177"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213100,"stop":1697105213105,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-76ac-7eae-9bcf-13b35a9c0181', '018b235a-76a6-7275-8def-b4619b5e9704', 'PENDING', now())","time":{"start":1697105213100,"stop":1697105213100,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-76ac-7eae-9bcf-13b35a9c0181', '018b235a-76a6-7275-8def-b4619b5e9704', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6e0c5743"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213107,"stop":1697105213111,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-76b2-7020-bbc6-a2cea83564d6', '018b235a-76a6-7275-8def-b4619b5e9704', 'ACTIVE', now())","time":{"start":1697105213107,"stop":1697105213107,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-76b2-7020-bbc6-a2cea83564d6', '018b235a-76a6-7275-8def-b4619b5e9704', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@46565184"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213112,"stop":1697105213117,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:53.111264900Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-76a6-7275-8def-b4619b5e9704'","time":{"start":1697105213112,"stop":1697105213112,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:53.111264900Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-76a6-7275-8def-b4619b5e9704'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@9bd43b7"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213118,"stop":1697105213124,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-76be-7f18-a623-d39b33777566', '018b235a-76a6-7275-8def-b4619b5e9704', 'TERMINATED', now())","time":{"start":1697105213118,"stop":1697105213118,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-76be-7f18-a623-d39b33777566', '018b235a-76a6-7275-8def-b4619b5e9704', 'TERMINATED', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@21f9c71e"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105213125,"stop":1697105213131,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:53.124551200Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB,\n    deleted_at = now()\nWHERE id = '018b235a-76a6-7275-8def-b4619b5e9704'","time":{"start":1697105213125,"stop":1697105213125,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:53.124551200Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB,\n    deleted_at = now()\nWHERE id = '018b235a-76a6-7275-8def-b4619b5e9704'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@2dc33a2d"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: message is published","time":{"start":1697105213131,"stop":1697105213131,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-7657-70ab-a0ef-58181b34b0b8/room-018b235a-7657-70ab-a0ef-58181b34b0b8/publish","time":{"start":1697105213131,"stop":1697105213226,"duration":95},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-7657-70ab-a0ef-58181b34b0b8/room-018b235a-7657-70ab-a0ef-58181b34b0b8/publish","time":{"start":1697105213131,"stop":1697105213226,"duration":95},"status":"passed","steps":[],"attachments":[{"uid":"6568c092c5c168cb","name":"Request","source":"6568c092c5c168cb.html","type":"text/html","size":1160},{"uid":"166d7c5940c78b59","name":"HTTP/1.1 200 OK","source":"166d7c5940c78b59.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-7657-70ab-a0ef-58181b34b0b8"},{"name":"roomId","value":"room-018b235a-7657-70ab-a0ef-58181b34b0b8"},{"name":"message","value":"{eventType=EVENT-018b235a-7657-70ab-a0ef-58181b34b0b8, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-7657-70ab-a0ef-58181b34b0b8"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-7657-70ab-a0ef-58181b34b0b8"},{"name":"roomId","value":"room-018b235a-7657-70ab-a0ef-58181b34b0b8"},{"name":"message","value":"{eventType=EVENT-018b235a-7657-70ab-a0ef-58181b34b0b8, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"then: publish succeeds","time":{"start":1697105213226,"stop":1697105213226,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"and: event is created","time":{"start":1697105213227,"stop":1697105213227,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105213227,"stop":1697105213237,"duration":10},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105213227,"stop":1697105213236,"duration":9},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-767f-7a8d-aa39-5a2dca74b0a6'\n  AND event_type_version_id = '018b235a-768d-718f-9bfb-16c12323b004'\n  AND event_type_id = '018b235a-7687-7c2e-a712-3440e3c32062'\n  AND publisher_id = '018b235a-7696-70bd-a4a9-c98210657379'","time":{"start":1697105213227,"stop":1697105213227,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-767f-7a8d-aa39-5a2dca74b0a6'\n  AND event_type_version_id = '018b235a-768d-718f-9bfb-16c12323b004'\n  AND event_type_id = '018b235a-7687-7c2e-a712-3440e3c32062'\n  AND publisher_id = '018b235a-7696-70bd-a4a9-c98210657379'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6e4c8583"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(1):","time":{"start":1697105213237,"stop":1697105213237,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"[id:018b235a-7702-74ce-aa62-56538a3edfee, room_id:018b235a-767f-7a8d-aa39-5a2dca74b0a6, event_type_version_id:018b235a-768d-718f-9bfb-16c12323b004, event_type_id:018b235a-7687-7c2e-a712-3440e3c32062, publisher_id:018b235a-7696-70bd-a4a9-c98210657379, correlation_id:018b235a-7702-7a51-9a49-531b4c6c0561, created_at:2023-10-12 13:06:53.186543]","time":{"start":1697105213237,"stop":1697105213237,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM EVENTS\nWHERE room_id = '018b235a-767f-7a8d-aa39-5a2dca74b0a6'\n  AND event_type_version_id = '018b235a-768d-718f-9bfb-16c12323b004'\n  AND event_type_id = '018b235a-7687-7c2e-a712-3440e3c32062'\n  AND publisher_id = '018b235a-7696-70bd-a4a9-c98210657379'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":4},{"name":"and: no message is published","time":{"start":1697105213271,"stop":1697105213271,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB results","time":{"start":1697105213271,"stop":1697105213276,"duration":5},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105213271,"stop":1697105213275,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7702-74ce-aa62-56538a3edfee'\n  AND published_at IS NOT NULL","time":{"start":1697105213272,"stop":1697105213272,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7702-74ce-aa62-56538a3edfee'\n  AND published_at IS NOT NULL"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@15774e00"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"Got rows(0):","time":{"start":1697105213275,"stop":1697105213275,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"SELECT *\nFROM published_messages\nWHERE event_id = '018b235a-7702-74ce-aa62-56538a3edfee'\n  AND published_at IS NOT NULL"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":3},{"name":"where","time":{"start":1697105213276,"stop":1697105213276,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":29},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PublishTests"},{"name":"testMethod","value":"Given: an event type with a TERMINATED subscription; When: message is published; Then: publish succeeds and event is created and no message is published"},{"name":"suite","value":"PublishTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.1 - Successful publish"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"POST /rooms/{memberId}/{roomId}/publish"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"subscriptionStatus","value":"a TERMINATED subscription"}],"links":[{"name":"UC6.1","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"dab7c6c99d9b7e97.json","parameterValues":["a TERMINATED subscription"]}