{"uid":"23338cfe30f85f16","name":"Given: event type with 1 active PULL subscription; When: message is pulled with problem 'subscriptionId query parameter not an uuid'; Then: pull fails with 500","fullName":"com.govstack.information_mediator.pubsub.api.messaging.PullTests.Given: event type with 1 active PULL subscription; When: message is pulled with problem '#problem'; Then: pull fails with #statusCode","historyId":"d2bea5c2119f302382e4b460d3fdf914","time":{"start":1697105226082,"stop":1697105226380,"duration":298},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: event type with 1 active PULL subscription","time":{"start":1697105226147,"stop":1697105226147,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105226147,"stop":1697105226153,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-a9a3-73d3-9593-ac63aab0a3c6', '018b235a-a985-785a-80bd-a1c471ba45a3', '018b235a-a98a-7676-bab6-c3f2996d1429', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a962-7def-96d0-0d01c2aaf88c', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:06.147747600Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105226148,"stop":1697105226148,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-a9a3-73d3-9593-ac63aab0a3c6', '018b235a-a985-785a-80bd-a1c471ba45a3', '018b235a-a98a-7676-bab6-c3f2996d1429', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a962-7def-96d0-0d01c2aaf88c', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:07:06.147747600Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@767e28e5"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226153,"stop":1697105226157,"duration":4},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a9a9-7a61-bce3-0133bc3b2356', '018b235a-a9a3-73d3-9593-ac63aab0a3c6', 'PENDING', now())","time":{"start":1697105226153,"stop":1697105226153,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a9a9-7a61-bce3-0133bc3b2356', '018b235a-a9a3-73d3-9593-ac63aab0a3c6', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@50d0fb48"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226158,"stop":1697105226161,"duration":3},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a9ad-722d-b3e9-63177a14b628', '018b235a-a9a3-73d3-9593-ac63aab0a3c6', 'ACTIVE', now())","time":{"start":1697105226158,"stop":1697105226158,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-a9ad-722d-b3e9-63177a14b628', '018b235a-a9a3-73d3-9593-ac63aab0a3c6', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6b5b865"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105226162,"stop":1697105226167,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:06.162267Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-a9a3-73d3-9593-ac63aab0a3c6'","time":{"start":1697105226162,"stop":1697105226162,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:07:06.162267Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-a9a3-73d3-9593-ac63aab0a3c6'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@135a2a14"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-a962-7def-96d0-0d01c2aaf88c/room-018b235a-a962-7def-96d0-0d01c2aaf88c/publish","time":{"start":1697105226167,"stop":1697105226325,"duration":158},"status":"passed","steps":[{"name":"POST /rooms/SANDBOX:ORG:TEST:PUBLISHER-018b235a-a962-7def-96d0-0d01c2aaf88c/room-018b235a-a962-7def-96d0-0d01c2aaf88c/publish","time":{"start":1697105226167,"stop":1697105226325,"duration":158},"status":"passed","steps":[],"attachments":[{"uid":"e5b5b0f5f181ec78","name":"Request","source":"e5b5b0f5f181ec78.html","type":"text/html","size":1160},{"uid":"aca43e46a24b6ba1","name":"HTTP/1.1 200 OK","source":"aca43e46a24b6ba1.html","type":"text/html","size":315}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-a962-7def-96d0-0d01c2aaf88c"},{"name":"roomId","value":"room-018b235a-a962-7def-96d0-0d01c2aaf88c"},{"name":"message","value":"{eventType=EVENT-018b235a-a962-7def-96d0-0d01c2aaf88c, content={payload=test}}"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:PUBLISHER-018b235a-a962-7def-96d0-0d01c2aaf88c"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0}],"attachments":[],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:PUBLISHER-018b235a-a962-7def-96d0-0d01c2aaf88c"},{"name":"roomId","value":"room-018b235a-a962-7def-96d0-0d01c2aaf88c"},{"name":"message","value":"{eventType=EVENT-018b235a-a962-7def-96d0-0d01c2aaf88c, content={payload=test}}"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":1},{"name":"when: message is pulled with a problem","time":{"start":1697105226326,"stop":1697105226326,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"GET /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a962-7def-96d0-0d01c2aaf88c/room-018b235a-a962-7def-96d0-0d01c2aaf88c/pull","time":{"start":1697105226326,"stop":1697105226356,"duration":30},"status":"passed","steps":[],"attachments":[{"uid":"d7559400f0e0e3c8","name":"Request","source":"d7559400f0e0e3c8.html","type":"text/html","size":779},{"uid":"51399d195ab63f7a","name":"HTTP/1.1 500 Internal Server Error","source":"51399d195ab63f7a.html","type":"text/html","size":387}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a962-7def-96d0-0d01c2aaf88c"},{"name":"roomId","value":"room-018b235a-a962-7def-96d0-0d01c2aaf88c"},{"name":"subscriptionId","value":"test"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-a962-7def-96d0-0d01c2aaf88c"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: pull fails","time":{"start":1697105226356,"stop":1697105226356,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105226380,"stop":1697105226380,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"stepsCount":15},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.messaging"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.messaging.PullTests"},{"name":"testMethod","value":"Given: event type with 1 active PULL subscription; When: message is pulled with problem 'subscriptionId query parameter not an uuid'; Then: pull fails with 500"},{"name":"suite","value":"PullTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC6.3 - Unsuccessful pull"},{"name":"epic","value":"Messaging-api"},{"name":"feature","value":"GET /rooms/{memberId}/{roomId}/pull"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Technical error: ([a-f0-9]{8}(-[a-f0-9]{4}){4}[a-f0-9]{8})"},{"name":"problem","value":"subscriptionId query parameter not an uuid"},{"name":"statusCode","value":"500"}],"links":[{"name":"UC6.3","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"23338cfe30f85f16.json","parameterValues":["Technical error: ([a-f0-9]{8}(-[a-f0-9]{4}){4}[a-f0-9]{8})","subscriptionId query parameter not an uuid","500"]}