{"uid":"16dbcd48af7e05be","name":"Given: a manager with a room; When: manager terminates the room with a problem: other member's room; Then: terminating room fails with 403: Forbidden","fullName":"com.govstack.information_mediator.pubsub.api.management.rooms.DeleteRoomTests.Given: a manager with a room; When: manager terminates the room with a problem: #problem; Then: terminating room fails with #statusCode: #message","historyId":"814a5f8e5883e450cf8b9e495ac2f764","time":{"start":1697105188611,"stop":1697105189085,"duration":474},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"passed","steps":[{"name":"given: a manager with a room","time":{"start":1697105188615,"stop":1697105188615,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105188658,"stop":1697105188667,"duration":9},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-1707-789c-850c-78db3ff2d8d3', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-1703-7897-8545-cefaeb3f2723', now(), NULL)","time":{"start":1697105188658,"stop":1697105188659,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-1707-789c-850c-78db3ff2d8d3', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-1703-7897-8545-cefaeb3f2723', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@52dbd3d"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188668,"stop":1697105188676,"duration":8},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-173b-7780-9c48-c6be01457849', '018b235a-1707-789c-850c-78db3ff2d8d3', 'room-018b235a-1703-7897-8545-cefaeb3f2723', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:28.667941500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105188669,"stop":1697105188669,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-173b-7780-9c48-c6be01457849', '018b235a-1707-789c-850c-78db3ff2d8d3', 'room-018b235a-1703-7897-8545-cefaeb3f2723', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:28.667941500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@31b9108b"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188677,"stop":1697105188687,"duration":10},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-1745-7bbb-b6d0-dcef55302eca', '018b235a-173b-7780-9c48-c6be01457849', 'EVENT-018b235a-1703-7897-8545-cefaeb3f2723', '[{\"at\": \"2023-10-12T10:06:28.677192700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105188678,"stop":1697105188678,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-1745-7bbb-b6d0-dcef55302eca', '018b235a-173b-7780-9c48-c6be01457849', 'EVENT-018b235a-1703-7897-8545-cefaeb3f2723', '[{\"at\": \"2023-10-12T10:06:28.677192700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@11e323a6"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188687,"stop":1697105188695,"duration":8},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-174f-7aeb-9865-3a2b81e9b3cd', '018b235a-1745-7bbb-b6d0-dcef55302eca', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:28.687231400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105188688,"stop":1697105188688,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-174f-7aeb-9865-3a2b81e9b3cd', '018b235a-1745-7bbb-b6d0-dcef55302eca', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:28.687231400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@704205ef"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188696,"stop":1697105188709,"duration":13},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-1757-777c-98ef-202aebcec32e', '018b235a-173b-7780-9c48-c6be01457849', '018b235a-1745-7bbb-b6d0-dcef55302eca', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-1703-7897-8545-cefaeb3f2723', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:28.696457900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105188697,"stop":1697105188697,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-1757-777c-98ef-202aebcec32e', '018b235a-173b-7780-9c48-c6be01457849', '018b235a-1745-7bbb-b6d0-dcef55302eca', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-1703-7897-8545-cefaeb3f2723', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:28.696457900Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@18ee9a8f"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188710,"stop":1697105188721,"duration":11},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1765-7b9d-ba63-ee7979edb7d3', '018b235a-1757-777c-98ef-202aebcec32e', 'PENDING', now())","time":{"start":1697105188711,"stop":1697105188711,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1765-7b9d-ba63-ee7979edb7d3', '018b235a-1757-777c-98ef-202aebcec32e', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@61aaec51"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188722,"stop":1697105188728,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1772-7312-92f0-b5a4ce6fd672', '018b235a-1757-777c-98ef-202aebcec32e', 'ACTIVE', now())","time":{"start":1697105188722,"stop":1697105188722,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-1772-7312-92f0-b5a4ce6fd672', '018b235a-1757-777c-98ef-202aebcec32e', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@69dc0dd1"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188729,"stop":1697105188744,"duration":15},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:28.728587100Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-1757-777c-98ef-202aebcec32e'","time":{"start":1697105188731,"stop":1697105188731,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:28.728587100Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-1757-777c-98ef-202aebcec32e'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@9d10078"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188744,"stop":1697105188755,"duration":11},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-1788-7df3-8d8f-98436f9d7301', '018b235a-173b-7780-9c48-c6be01457849', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-1703-7897-8545-cefaeb3f2723', '[{\"at\": \"2023-10-12T10:06:28.744092200Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105188745,"stop":1697105188745,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publishers (id, room_id, identifier_type, identifier, journal, deleted_at) VALUES ('018b235a-1788-7df3-8d8f-98436f9d7301', '018b235a-173b-7780-9c48-c6be01457849', 'INTERNAL', 'SANDBOX:ORG:TEST:PUBLISHER-018b235a-1703-7897-8545-cefaeb3f2723', '[{\"at\": \"2023-10-12T10:06:28.744092200Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6587c92f"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188756,"stop":1697105188762,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-1793-7f06-836c-911939959bdd', '018b235a-1788-7df3-8d8f-98436f9d7301', '018b235a-1745-7bbb-b6d0-dcef55302eca', now(), NULL)","time":{"start":1697105188756,"stop":1697105188756,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO publisher_constraints (id, publisher_id, event_type_id, created_at, deleted_at) VALUES ('018b235a-1793-7f06-836c-911939959bdd', '018b235a-1788-7df3-8d8f-98436f9d7301', '018b235a-1745-7bbb-b6d0-dcef55302eca', now(), NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@537979aa"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: manager terminates the room","time":{"start":1697105188762,"stop":1697105188762,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105188768,"stop":1697105188773,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-179f-7346-8a27-2b28fb4c54f8', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-2-018b235a-1703-7897-8545-cefaeb3f2723', now(), NULL)","time":{"start":1697105188768,"stop":1697105188768,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-179f-7346-8a27-2b28fb4c54f8', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-2-018b235a-1703-7897-8545-cefaeb3f2723', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4398d"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105188778,"stop":1697105188786,"duration":8},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-17aa-7134-a378-ea7651927df2', '018b235a-179f-7346-8a27-2b28fb4c54f8', 'room2-018b235a-1703-7897-8545-cefaeb3f2723', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:28.778289500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105188779,"stop":1697105188779,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-17aa-7134-a378-ea7651927df2', '018b235a-179f-7346-8a27-2b28fb4c54f8', 'room2-018b235a-1703-7897-8545-cefaeb3f2723', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:28.778289500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@1ad28f2"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DELETE /rooms/SANDBOX:ORG:TEST:MANAGER-2-018b235a-1703-7897-8545-cefaeb3f2723/room2-018b235a-1703-7897-8545-cefaeb3f2723","time":{"start":1697105188787,"stop":1697105188881,"duration":94},"status":"passed","steps":[],"attachments":[{"uid":"2c10a08253a83753","name":"Request","source":"2c10a08253a83753.html","type":"text/html","size":729},{"uid":"afea63605ed67019","name":"HTTP/1.1 403 ","source":"afea63605ed67019.html","type":"text/html","size":1007}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:MANAGER-2-018b235a-1703-7897-8545-cefaeb3f2723"},{"name":"roomId","value":"room2-018b235a-1703-7897-8545-cefaeb3f2723"},{"name":"header","value":"X-Road-Client=SANDBOX:ORG:TEST:MANAGER-018b235a-1703-7897-8545-cefaeb3f2723"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: terminating room fails","time":{"start":1697105188881,"stop":1697105188881,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105189085,"stop":1697105189085,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":29},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.rooms"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.rooms.DeleteRoomTests"},{"name":"testMethod","value":"Given: a manager with a room; When: manager terminates the room with a problem: other member's room; Then: terminating room fails with 403: Forbidden"},{"name":"suite","value":"DeleteRoomTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC3.10 - Unsuccessful room termination"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"DELETE /rooms/{memberId}/{roomId}"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Forbidden"},{"name":"problem","value":"other member's room"},{"name":"statusCode","value":"403"}],"links":[{"name":"M604017-174","url":"https://jira.nortal.com/browse/M604017-174","type":"issue"},{"name":"UC3.10","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"16dbcd48af7e05be.json","parameterValues":["Forbidden","other member's room","403"]}