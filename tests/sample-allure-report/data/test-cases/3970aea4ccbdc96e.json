{"uid":"3970aea4ccbdc96e","name":"Given: member's subscription; When: member unsubscribes with problem ''X-Road-Client' header not matching 'memberId''; Then: unsubscribe fails with 403","fullName":"com.govstack.information_mediator.pubsub.api.management.subscriptions.UnsubscribeTests.Given: member's subscription; When: member unsubscribes with problem '#problem'; Then: unsubscribe fails with #statusCode","historyId":"f165c4dbae673aa68746fc0d98eaf9c6","time":{"start":1697105209845,"stop":1697105210125,"duration":280},"status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup","time":{"start":1697105209845,"stop":1697105209914,"duration":69},"status":"passed","steps":[{"name":"DB query","time":{"start":1697105209886,"stop":1697105209892,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-69f5-707b-815e-49413ef00d44', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-69f5-78a3-b274-153a8630791e', now(), NULL)","time":{"start":1697105209886,"stop":1697105209886,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO managers(id, identifier_type, identifier, created_at, deleted_at)\nVALUES ('018b235a-69f5-707b-815e-49413ef00d44', 'XROAD', 'SANDBOX:ORG:TEST:MANAGER-018b235a-69f5-78a3-b274-153a8630791e', now(), NULL)\n"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@658ec00c"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209893,"stop":1697105209901,"duration":8},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-6a24-7c1e-8388-936c8df60e2e', '018b235a-69f5-707b-815e-49413ef00d44', 'room-018b235a-69f5-78a3-b274-153a8630791e', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:49.892634700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209893,"stop":1697105209893,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO rooms (id, manager_id, identifier, \"configuration\", journal, deleted_at) VALUES ('018b235a-6a24-7c1e-8388-936c8df60e2e', '018b235a-69f5-707b-815e-49413ef00d44', 'room-018b235a-69f5-78a3-b274-153a8630791e', '{\"messageExpiration\": 0, \"deliveryDelay\": 1, \"deliveryDelayMultiplier\": 1.01, \"deliveryAttempts\": 3}', '[{\"at\": \"2023-10-12T10:06:49.892634700Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3565ee15"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209901,"stop":1697105209908,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-6a2d-735a-a129-0436c523c58d', '018b235a-6a24-7c1e-8388-936c8df60e2e', 'EVENT-018b235a-69f5-78a3-b274-153a8630791e', '[{\"at\": \"2023-10-12T10:06:49.901780400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209901,"stop":1697105209901,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_types(id, room_id, identifier, journal, deleted_at) VALUES ('018b235a-6a2d-735a-a129-0436c523c58d', '018b235a-6a24-7c1e-8388-936c8df60e2e', 'EVENT-018b235a-69f5-78a3-b274-153a8630791e', '[{\"at\": \"2023-10-12T10:06:49.901780400Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@4fe3d15f"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209908,"stop":1697105209914,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-6a34-7d6c-a536-0158e49700e5', '018b235a-6a2d-735a-a129-0436c523c58d', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:49.908801500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209908,"stop":1697105209908,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO event_type_versions (id, event_type_id, \"version\", json_schema, journal, deleted_at) VALUES('018b235a-6a34-7d6c-a536-0158e49700e5', '018b235a-6a2d-735a-a129-0436c523c58d', 1, '{\n   \"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\n   \"$id\":\"https://example.com/event-type.schema.json\",\n   \"title\":\"EVENT-001 Schema\",\n   \"description\":\"Any content\",\n   \"type\":\"object\",\n   \"properties\":{\n      \"payload\":{\n         \"type\":\"string\",\n         \"description\":\"The content of the payload\"\n      }\n   },\n   \"required\":[\n      \"payload\"\n   ]\n}', '[{\"at\": \"2023-10-12T10:06:49.908801500Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@37495d56"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":8}],"testStage":{"status":"passed","steps":[{"name":"given: member's subscription","time":{"start":1697105209918,"stop":1697105209918,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DB query","time":{"start":1697105209918,"stop":1697105209924,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6a3e-77b3-94e5-c94cac011c75', '018b235a-6a24-7c1e-8388-936c8df60e2e', '018b235a-6a2d-735a-a129-0436c523c58d', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-69f5-78a3-b274-153a8630791e', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:49.918693Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)","time":{"start":1697105209918,"stop":1697105209918,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscriptions (id, room_id, event_type_id, identifier_type, identifier, parameters, journal, deleted_at) VALUES ('018b235a-6a3e-77b3-94e5-c94cac011c75', '018b235a-6a24-7c1e-8388-936c8df60e2e', '018b235a-6a2d-735a-a129-0436c523c58d', 'XROAD', 'SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-69f5-78a3-b274-153a8630791e', '{\"method\":\"PULL\"}', '[{\"at\": \"2023-10-12T10:06:49.918693Z\", \"by\": \"TESTS\", \"action\": \"CREATED\"}]', NULL)"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@24546513"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209925,"stop":1697105209930,"duration":5},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6a44-75fe-a912-0acfc3f53ac9', '018b235a-6a3e-77b3-94e5-c94cac011c75', 'PENDING', now())","time":{"start":1697105209925,"stop":1697105209925,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6a44-75fe-a912-0acfc3f53ac9', '018b235a-6a3e-77b3-94e5-c94cac011c75', 'PENDING', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@3e5b32ca"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209931,"stop":1697105209938,"duration":7},"status":"passed","steps":[{"name":"Executing SQL query:\n INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6a4b-70c7-bb21-9e91460e3ae5', '018b235a-6a3e-77b3-94e5-c94cac011c75', 'ACTIVE', now())","time":{"start":1697105209931,"stop":1697105209931,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"INSERT INTO subscription_status (id, subscription_id, status, updated_at) VALUES ('018b235a-6a4b-70c7-bb21-9e91460e3ae5', '018b235a-6a3e-77b3-94e5-c94cac011c75', 'ACTIVE', now())"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@6fe37577"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"DB query","time":{"start":1697105209938,"stop":1697105209944,"duration":6},"status":"passed","steps":[{"name":"Executing SQL query:\n UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:49.938399900Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-6a3e-77b3-94e5-c94cac011c75'","time":{"start":1697105209938,"stop":1697105209938,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"query","value":"UPDATE subscriptions\nSET journal = journal || '[{\"at\": \"2023-10-12T10:06:49.938399900Z\", \"by\": \"TESTS\", \"action\": \"MODIFIED\"}]'::JSONB\nWHERE id = '018b235a-6a3e-77b3-94e5-c94cac011c75'"},{"name":"executionMethod","value":"org.codehaus.groovy.runtime.MethodClosure@12bd2630"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"stepsCount":1},{"name":"when: member unsubscribes with problem","time":{"start":1697105209944,"stop":1697105209944,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"DELETE /rooms/SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-69f5-78a3-b274-153a8630791e/room-018b235a-69f5-78a3-b274-153a8630791e/subscriptions/018b235a-6a3e-77b3-94e5-c94cac011c75","time":{"start":1697105209945,"stop":1697105209990,"duration":45},"status":"passed","steps":[],"attachments":[{"uid":"cf380b8a3b9c25c5","name":"Request","source":"cf380b8a3b9c25c5.html","type":"text/html","size":733},{"uid":"1bf423982b8c21e0","name":"HTTP/1.1 403 ","source":"1bf423982b8c21e0.html","type":"text/html","size":1058}],"parameters":[{"name":"memberId","value":"SANDBOX:ORG:TEST:SUBSCRIBER-018b235a-69f5-78a3-b274-153a8630791e"},{"name":"roomId","value":"room-018b235a-69f5-78a3-b274-153a8630791e"},{"name":"subscriptionId","value":"018b235a-6a3e-77b3-94e5-c94cac011c75"},{"name":"header","value":"X-Road-Client=non-existent"}],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":0},{"name":"then: unsubscribe fails","time":{"start":1697105209990,"stop":1697105209990,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0},{"name":"where","time":{"start":1697105210125,"stop":1697105210125,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"stepsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"stepsCount":13},"afterStages":[],"labels":[{"name":"package","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions"},{"name":"testClass","value":"com.govstack.information_mediator.pubsub.api.management.subscriptions.UnsubscribeTests"},{"name":"testMethod","value":"Given: member's subscription; When: member unsubscribes with problem ''X-Road-Client' header not matching 'memberId''; Then: unsubscribe fails with 403"},{"name":"suite","value":"UnsubscribeTests"},{"name":"host","value":"lenovo1765"},{"name":"thread","value":"28024@lenovo1765.Test worker(1)"},{"name":"framework","value":"spock"},{"name":"language","value":"java"},{"name":"parentSuite","value":"GenericSpecification"},{"name":"story","value":"UC4.7 - Unsuccessful unsubscribe"},{"name":"epic","value":"Management-api"},{"name":"feature","value":"DELETE /rooms/{memberId}/{roomId}/subscriptions/{subscriptionId}"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"message","value":"Forbidden"},{"name":"problem","value":"'X-Road-Client' header not matching 'memberId'"},{"name":"statusCode","value":"403"}],"links":[{"name":"UC4.7","type":"tms"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":[]},"source":"3970aea4ccbdc96e.json","parameterValues":["Forbidden","'X-Road-Client' header not matching 'memberId'","403"]}